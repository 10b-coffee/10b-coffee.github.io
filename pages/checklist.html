<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì²´í¬ë¦¬ìŠ¤íŠ¸ - ë°±ì–µì»¤í”¼ í†µí•© ìš´ì˜ ë§¤ë‰´ì–¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        html { scroll-behavior: smooth; }
        body { font-family: 'Pretendard', sans-serif; background-color: #FDFBF8; }
        .gnb-link.active { background-color: #8D6E63; color: white; }
        
        #checklist-progress-container.sticky { padding-top: 0.5rem; padding-bottom: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        #checklist-progress-container .details-wrapper { max-height: 100px; transition: max-height 0.3s ease-in-out, margin-bottom 0.3s ease-in-out, opacity 0.3s ease-in-out; overflow: hidden; }
        #checklist-progress-container.sticky .details-wrapper { max-height: 0; margin-bottom: 0 !important; opacity: 0; }
        .progress-bar-wrapper { flex-grow: 1; background-color: #e5e7eb; border-radius: 9999px; height: 1.25rem; overflow: hidden; transition: height 0.3s ease-in-out; }
        #checklist-progress-container.sticky .progress-bar-wrapper { height: 0.75rem; }
        .progress-bar { height: 100%; border-radius: 9999px; transition: width 0.3s ease-in-out; }
        .task-card { display: flex; align-items: center; background-color: white; border: 1px solid #EAE2DA; border-radius: 0.5rem; padding: 1rem; transition: all 0.3s ease-in-out; margin-bottom: 0.75rem; }
        .task-card.completed { opacity: 0.6; background-color: #f3f4f6; }
        .task-card.completed .task-main label { text-decoration: line-through; }
        .task-description { font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem; padding-left: 0.25rem; }
        .task-group-header { top: 108px; /* GNB (64px) + shrunken progress bar (~44px) */ }
        .custom-checkbox { appearance: none; -webkit-appearance: none; min-width: 1.5rem; width: 1.5rem; height: 1.5rem; border: 2px solid #D1C3B4; border-radius: 0.375rem; cursor: pointer; display: grid; place-content: center; }
        .custom-checkbox::before { content: ""; width: 0.8rem; height: 0.8rem; transform: scale(0); transition: 120ms transform ease-in-out; box-shadow: inset 1em 1em #8D6E63; transform-origin: bottom left; clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%); }
        .custom-checkbox:checked::before { transform: scale(1); }
        .modal-backdrop { transition: opacity 0.3s ease; }
        .modal-content { animation: zoomIn 0.3s ease forwards; }
        @keyframes zoomIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .confetti { width: 10px; height: 10px; background-color: #f00; position: absolute; top: 0; animation: fall 3s linear forwards; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .shift-btn-radio { display: none; }
        .shift-btn-radio + label { transition: all 0.2s ease-in-out; cursor: pointer; border: 2px solid transparent; }
        .shift-btn-radio:checked + label { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-color: #6D4C41; }
    </style>
</head>
<body class="text-gray-800">

    <header id="main-gnb" class="bg-white shadow-md sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <a href="../index.html" class="gnb-link font-bold text-xl text-[#6D4C41] hidden md:flex items-center">
                        <i class="fas fa-home mr-2"></i>ë°±ì–µì»¤í”¼ ë§¤ë‰´ì–¼
                    </a>
                    <a href="../index.html" class="gnb-link flex md:hidden items-center space-x-2">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSmgK7X5UjYipj8B0revMEDlmBiNaoJfIDfpw&s" class="h-8 w-auto" alt="ë°±ì–µì»¤í”¼ ë¡œê³ ">
                        <span class="font-bold text-lg text-[#6D4C41]">ë§¤ë‰´ì–¼</span>
                    </a>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="settings.html" class="gnb-link text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium">ì‹œìŠ¤í…œ</a>
                        <a href="order.html" class="gnb-link text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium">ë°œì£¼/ì¬ê³ </a>
                        <a href="menupan.html" class="gnb-link text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium">ë©”ë‰´ê´€ë¦¬</a>
                        <a href="storemgnt.html" class="gnb-link text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium">ì²­ì†Œ</a>
                        <a href="checklist.html" class="gnb-link text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium active">ì²´í¬ë¦¬ìŠ¤íŠ¸</a>
                        <a href="../index.html" class="gnb-link text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium">ë ˆì‹œí”¼</a>
                    </div>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <button type="button" id="mobile-menu-button" class="bg-white inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white">
                        <span class="sr-only">Open main menu</span>
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="md:hidden hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                 <a href="settings.html" class="text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium">ì‹œìŠ¤í…œ ê´€ë¦¬</a>
                 <a href="order.html" class="text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium">ë°œì£¼/ì¬ê³ </a>
                 <a href="menupan.html" class="text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium">ë©”ë‰´ê´€ë¦¬</a>
                 <a href="storemgnt.html" class="text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium">ì²­ì†Œ</a>
                 <a href="checklist.html" class="text-gray-600 bg-[#E0DACE] text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium">ì²´í¬ë¦¬ìŠ¤íŠ¸</a>
                 <a href="../index.html" class="text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium">ë ˆì‹œí”¼</a>
            </div>
        </div>
    </header>

    <main id="checklist-view" class="p-4 sm:p-8 max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-[#6D4C41] mb-8 text-center">ê·¼ë¬´ êµëŒ€ ì²´í¬ë¦¬ìŠ¤íŠ¸</h1>
        
        <div id="user-info-container">
            <form id="user-info-form" class="bg-white rounded-lg shadow-md p-6 space-y-6">
                 <h2 class="text-xl font-semibold text-center text-gray-700">ê·¼ë¬´ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ì‹œì‘í•˜ì„¸ìš”.</h2>
                <div>
                    <label for="worker-name" class="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„</label>
                    <input type="text" id="worker-name" required class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#A1887F] focus:border-[#A1887F] sm:text-sm">
                </div>
                <div>
                    <label for="work-date" class="block text-sm font-medium text-gray-700 mb-1">ë‚ ì§œ</label>
                    <input type="date" id="work-date" required class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#A1887F] focus:border-[#A1887F] sm:text-sm">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ê·¼ë¬´ íƒ€ì„</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <input type="radio" name="shift" id="shift-open" value="open" class="shift-btn-radio" required>
                        <label for="shift-open" class="block text-center bg-yellow-400 text-white font-bold py-3 rounded-lg shadow-md">ğŸŒ ì˜¤í”ˆ</label>
                        <input type="radio" name="shift" id="shift-middle" value="middle" class="shift-btn-radio">
                        <label for="shift-middle" class="block text-center bg-sky-400 text-white font-bold py-3 rounded-lg shadow-md">ğŸŒ¥ï¸ ë¯¸ë“¤</label>
                        <input type="radio" name="shift" id="shift-closing" value="closing" class="shift-btn-radio">
                        <label for="shift-closing" class="block text-center bg-indigo-400 text-white font-bold py-3 rounded-lg shadow-md">ğŸŒœ ë§ˆê°</label>
                        <input type="radio" name="shift" id="shift-late-night" value="late-night" class="shift-btn-radio">
                        <label for="shift-late-night" class="block text-center bg-gray-600 text-white font-bold py-3 rounded-lg shadow-md">â­ ì‹¬ì•¼</label>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="start-time" class="block text-sm font-medium text-gray-700 mb-1">ì‹œì‘ ì‹œê°„</label>
                        <input type="time" id="start-time" required class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#A1887F] focus:border-[#A1887F] sm:text-sm">
                    </div>
                    <div>
                        <label for="end-time" class="block text-sm font-medium text-gray-700 mb-1">ì¢…ë£Œ ì‹œê°„</label>
                        <input type="time" id="end-time" required class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#A1887F] focus:border-[#A1887F] sm:text-sm">
                    </div>
                </div>
                <button type="submit" class="w-full bg-[#8D6E63] text-white font-bold py-3 px-4 rounded-lg hover:bg-[#A1887F] transition-all">ì²´í¬ë¦¬ìŠ¤íŠ¸ ì‹œì‘</button>
            </form>
        </div>

        <div id="checklist-area" class="hidden">
            <div class="sticky top-[64px] z-20" id="progress-bar-sticky-wrapper">
                <div id="checklist-progress-container" class="bg-white rounded-lg p-6 mb-6 transition-all duration-300">
                    <div class="details-wrapper mb-4">
                        <div class="flex justify-between items-center">
                            <h2 id="progress-title" class="text-xl font-bold text-[#6D4C41]">ì—…ë¬´ ì™„ë£Œ í˜„í™©</h2>
                            <button id="reset-checklist-btn" class="text-sm text-gray-500 hover:text-gray-800 transition-colors"><i class="fas fa-undo mr-1"></i>ì²˜ìŒìœ¼ë¡œ</button>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <div id="progress-bar-label" class="w-20 text-center font-semibold text-gray-700 shrink-0"></div>
                        <div class="progress-bar-wrapper"><div id="progress-bar" class="progress-bar" style="width: 0%;"></div></div>
                        <span id="progress-text" class="w-12 text-right font-medium text-gray-700 text-lg shrink-0">0%</span>
                    </div>
                </div>
            </div>
            <div id="task-list-container" class="flex flex-col relative z-10"></div>
            <button id="incomplete-handover-btn" class="mt-6 w-full bg-gray-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-600 transition-all">ì™„ë£Œ ì—†ì´ êµëŒ€í•˜ê¸°</button>
        </div>
    </main>
    
    <!-- Modals -->
    <div id="completion-modal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div id="confetti-container" class="absolute inset-0 overflow-hidden"></div>
        <div class="modal-content bg-white rounded-2xl shadow-2xl p-6 sm:p-8 max-w-md w-full text-center relative transform opacity-0">
            <h2 class="text-3xl sm:text-4xl font-bold text-[#8D6E63] mb-4">ğŸ‰ êµëŒ€ ì¤€ë¹„ ì™„ë£Œ! ğŸ‰</h2>
            <div class="bg-gray-100 rounded-lg p-4 mb-6 text-left text-sm text-gray-600">
                <p><strong class="w-16 inline-block">ê·¼ë¬´ì:</strong> <span id="modal-worker-name"></span></p>
                <p><strong class="w-16 inline-block">ë‚ ì§œ:</strong> <span id="modal-work-date"></span></p>
                <p><strong class="w-16 inline-block">ê·¼ë¬´ì‹œê°„:</strong> <span id="modal-work-time"></span></p>
            </div>
            <p class="text-gray-700 text-lg mb-6">ì˜¤ëŠ˜ í•˜ë£¨ë„ ìˆ˜ê³  ë§ìœ¼ì…¨ì–´ìš”! ğŸ‘</p>
            <p class="bg-amber-100 text-amber-800 font-semibold p-4 rounded-lg"><i class="fas fa-camera mr-2"></i>ì´ í™”ë©´ì„ ìº¡ì²˜í•˜ì—¬ ë‹¨í†¡ë°©ì— ì˜¬ë ¤ì£¼ì„¸ìš”.</p>
            <button id="close-modal-btn" class="mt-8 bg-[#8D6E63] text-white font-bold py-2 px-6 rounded-lg hover:bg-[#A1887F] transition-all">ë‹«ê¸°</button>
        </div>
    </div>
    
    <div id="incomplete-modal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div class="modal-content bg-white rounded-2xl shadow-2xl p-6 sm:p-8 max-w-md w-full text-center relative transform opacity-0">
            <h2 class="text-3xl sm:text-4xl font-bold text-[#8D6E63] mb-4">ğŸ“ ì¸ìˆ˜ì¸ê³„ì„œ</h2>
            <div class="bg-gray-100 rounded-lg p-4 mb-4 text-left text-sm text-gray-600">
                <p><strong class="w-16 inline-block">ê·¼ë¬´ì:</strong> <span id="incomplete-modal-worker-name"></span></p>
                <p><strong class="w-16 inline-block">ë‚ ì§œ:</strong> <span id="incomplete-modal-work-date"></span></p>
                <p><strong class="w-16 inline-block">ê·¼ë¬´ì‹œê°„:</strong> <span id="incomplete-modal-work-time"></span></p>
            </div>
            <p id="incomplete-message" class="text-gray-700 text-lg mb-4"></p>
            <p class="text-2xl font-bold mb-4">ì´ <span id="incomplete-percentage"></span>% ì™„ë£Œ</p>
            <div id="incomplete-tasks-list" class="text-left bg-red-50 border border-red-200 rounded-lg p-4 max-h-48 overflow-y-auto">
                <h3 class="font-bold text-red-800 mb-2">ë¯¸ì™„ë£Œ ì—…ë¬´:</h3>
                <ul class="list-disc list-inside text-red-700 text-sm space-y-1"></ul>
            </div>
            <p class="mt-6 bg-amber-100 text-amber-800 font-semibold p-4 rounded-lg"><i class="fas fa-camera mr-2"></i>ì´ í™”ë©´ì„ ìº¡ì²˜í•˜ì—¬ ì¸ìˆ˜ì¸ê³„ í•´ì£¼ì„¸ìš”.</p>
            <button id="close-incomplete-modal-btn" class="mt-6 bg-[#8D6E63] text-white font-bold py-2 px-6 rounded-lg hover:bg-[#A1887F] transition-all">ë‹«ê¸°</button>
        </div>
    </div>

<script>
const checklistData = {
    common: [
        { group: 'ì¶œê·¼ ì‹œ', task: 'ì¡°ëª… / ì–´ë‹ / DID ëª¨ë‹ˆí„° í™•ì¸' },
        { group: 'ì¶œê·¼ ì‹œ', task: 'ë°°ë‹¬ ì–´í”Œ í™•ì¸' },
        { group: 'ì¶œê·¼ ì‹œ', task: 'ì‹œì¬ ì¸ìˆ˜ì¸ê³„ ë° ì „ë‹¬ì‚¬í•­ í™•ì¸' },
        { group: 'ì¶œê·¼ ì‹œ', task: 'ì œë¹™ê¸° ì–¼ìŒì–‘ í™•ì¸' },
        { group: 'êµì²´ ì‹œ', task: '<span class="font-bold">ì›ë‘:</span> ê·¸ë¼ì¸ë” í˜¸í¼ ë¶„ë¦¬ í›„ ì²­ì†Œ' },
        { group: 'êµì²´ ì‹œ', task: '<span class="font-bold">ì‹œëŸ½:</span> êµ³ì§€ ì•Šë„ë¡ ëœ¨ê±°ìš´ ë¬¼ ë¹¼ì£¼ê¸°' },
        { group: 'ì±„ì›Œì£¼ê¸°', task: 'ê°ì¢… ë¶€ìì¬ ë° ì†Œëª¨í’ˆ', description: 'íŒì½˜, ë‚˜ìµ¸, ëŒ€ìš©ëŸ‰ ë² ì´ìŠ¤, ê°€ë‹¹ë”¸ê¸°, ëƒ‰ì¥í•´ë™ ë””ì €íŠ¸, ì˜¤ì§•ì–´, 2ì˜¨ìŠ¤ ì†ŒìŠ¤í†µ, ì‹œëŸ½, íŒŒìš°ë” ë“±' },
        { group: 'í‡´ê·¼ í•œ ì‹œê°„ ì „', task: 'ì“°ë ˆê¸° ë° ì²­ê²° ìƒíƒœ í™•ì¸', description: 'ì»¤í”¼í½, ì“°ë ˆê¸°í†µ, ì‹±í¬ëŒ€, ìš°ìœ ê³½, ë°°ìˆ˜êµ¬ í™•ì¸ ë° êµì²´' },
        { group: 'í‡´ê·¼ í•œ ì‹œê°„ ì „', task: 'ê¸°ê¸° ì²­ì†Œ', description: 'ìë™ íƒ¬í•‘ê¸° ë‚´ë¶€ ë¸ŒëŸ¬ì‰¬ ì²­ì†Œ, ì‹¤ë§ê¸° ì˜¤ì—¼ ì œê±°' },
        { group: 'í‡´ê·¼ í•œ ì‹œê°„ ì „', task: 'ì»¤í”¼ ë°” ì „ì²´ ì •ë¦¬ ë° ì²­ì†Œ' },
        { group: 'í‡´ê·¼ í•œ ì‹œê°„ ì „', task: 'ì†Œë„êµ¬ ì •ë¦¬', description: 'ì°ë”¸ê¸°ìš© ê³„ëŸ‰ìŠ¤í‘¼ ë¬¼ êµì²´, í–‰ì£¼/ìŠ¤íŒ€í–‰ì£¼ ì„¸ì²™' },
        { group: 'í‡´ê·¼ í•œ ì‹œê°„ ì „', task: 'ì‹œì¬ í™•ì¸ ë° ì¸ìˆ˜ì¸ê³„ ì‚¬í•­ ë‚¨ê¸°ê¸°' },
    ],
    open: [
        { group: 'ì˜¤í”ˆ ì—…ë¬´', task: 'í”½ì—…ëŒ€ ë° í¬ìŠ¤ê¸° ì£¼ë³€ ì •ë¦¬ ë° ì²­ì†Œ' },
        { group: 'ì˜¤í”ˆ ì—…ë¬´', task: 'í–‰ì£¼ ì„¸ì²™' },
        { group: 'ì˜¤í”ˆ ì—…ë¬´', task: 'ì¬ê³  ì •ë¦¬ ë° í™•ì¸', description: 'ëƒ‰ì¥/ìƒì˜¨/ì‹¤ì˜¨ ì •ë¦¬ ë° ì„ ì…ì„ ì¶œ í™•ì¸, ì¬ê³  ë° ë°œì£¼ í™•ì¸' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold">(ë§¤ì¼)</span> ìƒë¶€/ëŒ€ìš©ëŸ‰ ëƒ‰ì¥ê³  ë¬¼ê¸° ì œê±°' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold">(ë§¤ì¼)</span> íŒŒìš°ë” ì„ ë°˜, ì‹œëŸ½ë³‘ ê·¼ì²˜ ë°”ë‹¥ ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold">(ë§¤ì¼)</span> íŒŒìš°ë” ìŠ¤í‘¼ ì„¸ì²™ ë° ê±´ì¡°' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold">(ì›”,ìˆ˜,ê¸ˆ)</span> ì‹±í¬ëŒ€ ë¬¼ë•Œ ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold">(í™”)</span> ì˜¤ê±°ë‚˜ì´ì € ë¹ˆ, íŒì½˜ ê¸°ê³„ ë’¤ìª½ ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold">(ëª©)</span> ì°½ë¬¸í‹€, í‚¤ì˜¤ìŠ¤í¬ ì–‘ìª½ ë¨¼ì§€ ì œê±°' },
    ],
    middle: [
        { group: 'ë¯¸ë“¤ ì—…ë¬´', task: 'ë§¤ì¥ ì™¸ë¶€ ì²­ì†Œ', description: 'ë§¤ì¥ ë°–, ë¬¸ ì• ì²­ì†Œ (ëª…í•¨, ì“°ë ˆê¸° ë“±)' },
        { group: 'ë¯¸ë“¤ ì—…ë¬´', task: 'ì¤‘ê°„ ì“°ë ˆê¸° ì²˜ë¦¬', description: 'ì˜ìˆ˜ì¦ ì“°ë ˆê¸°í†µ, ì»¤í”¼ í½ ë¹„ìš°ê¸°' },
        { group: 'ë¯¸ë“¤ ì—…ë¬´', task: 'ì „ì²´ ë°”ë‹¥ ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold">(ë§¤ì¼)</span> ì•„ì´ìŠ¤ë¹ˆ ë° ì„œë ë‚´ë¶€ ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold">(ë§¤ì¼)</span> ë¹™ìˆ˜ê¸°ê³„, ë””í¼ì›°, ì†Œë„êµ¬ ì„¸ì²™' },
    ],
    closing: [
        { group: 'ë§ˆê°/ì €ë… ì—…ë¬´', task: '<span class="font-bold">[18:00-20:00]</span> ë¦¬ë·° ëŒ“ê¸€ ë‹¬ê¸°' },
        { group: 'ë§ˆê°/ì €ë… ì—…ë¬´', task: '<span class="font-bold">[20:30]</span> ì‹¬ì•¼ ëŒ€ë¹„ ì¬ë£Œ í™•ì¸', description: 'ë³¶ìŒë°¥/ê°•ì • ë“± ì‹¬ì•¼ ì‹œê°„ëŒ€ ì¬ë£Œ ì†Œë¶„ ë° ì¤€ë¹„' },
        { group: 'ë§ˆê° ì²­ì†Œ - ì»¤í”¼ë¨¸ì‹ ', task: '<span class="font-semibold">(ë§¤ì¼)</span> ê·¸ë£¹í—¤ë“œ ì²­ì†Œ', description: 'ì†” ì²­ì†Œ ë° ë¬¼ í˜ë¦¬ê¸°' },
        { group: 'ë§ˆê° ì²­ì†Œ - ì»¤í”¼ë¨¸ì‹ ', task: '<span class="font-semibold">(ë§¤ì¼)</span> í¬í„°í•„í„° ë° íŠ¸ë ˆì´ ì„¸ì²™', description: 'ìš©ì•¡ ì„¸ì²™, íŠ¸ë ˆì´ ë¶„ë¦¬ ì„¸ì²™' },
        { group: 'ë§ˆê° ì²­ì†Œ - ì»¤í”¼ë¨¸ì‹ ', task: '<span class="font-semibold">(ë§¤ì¼)</span> ì»¤í”¼ë¨¸ì‹  ì£¼ë³€ê¸°ê¸° ì²­ì†Œ', description: 'ë¨¸ì‹  ì „ì²´, ê·¸ë¼ì¸ë”, íƒ¬í•‘ê¸° ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ - ì»¤í”¼ë¨¸ì‹ ', task: '<span class="font-semibold">(ë§¤ì¼)</span> ì˜¨ìˆ˜ê¸° ì²­ì†Œ', description: 'í™€ë”ìƒì, ë¬¼ ì…ì¶œêµ¬, ì½”í¬ ì†ì¡ì´ ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ - ì»¤í”¼ë¨¸ì‹ ', task: '<span class="font-semibold">(ë§¤ì¼)</span> ì¡°ë¦¬ê¸°êµ¬ ì„¸ì²™', description: 'ì—ì–´í”„ë¼ì´ì–´ ë§, ì „ìë ˆì¸ì§€ìš© ì ‘ì‹œ ì„¸ì²™' },
    ],
    'late-night': [
        { group: 'ì‹¬ì•¼ ì—…ë¬´', task: 'ì˜ì—… ì¢…ë£Œ ì¤€ë¹„', description: 'ì–´ë‹ ì ‘ê¸°, ì‹œì¬ ì •ë¦¬, í¬ìŠ¤ ë§ˆê° ë° ë³´ê³ ' },
        { group: 'ì‹¬ì•¼ ì—…ë¬´', task: 'ë¬¼ë¥˜ ì…ê³  í™•ì¸ ë° ì •ë¦¬ (ë¶ˆëŸ‰ ì²´í¬)' },
        { group: 'ì‹¬ì•¼ ì—…ë¬´', task: '<span class="font-bold">[í‰ì¼]</span> í¬ì¥ì¬ ë¯¸ë¦¬ ì¤€ë¹„', description: 'í•«ë„ê·¸ë°•ìŠ¤, ì˜¤ì§•ì–´ìƒì, ìº”/ì¼€ì´í¬ ìŠ¤í‹°ì»¤ ë“±' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold">(ë§¤ì¼)</span> ì¡°ë¦¬/ì œì¡° ë„êµ¬ ë§ˆê°', description: 'ì—ì–´í”„ë¼ì´ì–´, ì ‘ì‹œ, ë°”ìŠ¤í‘¼í†µ, ë””í¼ì›° ë§ˆê°' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold">(ë§¤ì¼)</span> ëª¨ë“  ì“°ë ˆê¸° ë°°ì¶œ' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold">(ë§¤ì¼)</span> ì°½ê³  ë° ëƒ‰ì¥ê³  ì•„ë˜ ì²­ì†Œ' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold">(ë§¤ì¼)</span> ì „ì²´ ë°”ë‹¥ ì“¸ê³  ë‹¦ê¸°', description: 'ì°½ê³  â†’ ì»¤í”¼ë°” â†’ í™€ ìˆœì„œ' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold">(ë§¤ì¼)</span> ì²­ì†Œë„êµ¬ ì •ë¦¬', description: 'ëŒ€ê±¸ë ˆ ì„¸ì²™, ìŠ¤íŒ€í–‰ì£¼ ì„¸ì²™ ë° ê±´ì¡°' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold">(ë§¤ì¼)</span> ê¸°íƒ€ ìš©í’ˆ ì„¸ì²™', description: 'ì˜ìˆ˜ì¦ í†µ ì„¸ì²™ ë° ê±´ì¡°, ì¼ë°˜í–‰ì£¼ ì„¸ì œì— ë‹´ê¶ˆë‘ê¸°' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold">(ì›”,ìˆ˜,ê¸ˆ)</span> ì“°ë ˆê¸°í†µ ì„¸ì²™', description: 'ìŒì‹ë¬¼ ì“°ë ˆê¸°í†µ, ë¶„ë¦¬ìˆ˜ê±°í•¨ ì„¸ì²™' },
    ]
};

document.addEventListener('DOMContentLoaded', () => {
    // Basic Element Selectors
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');

    // --- Checklist App ---
    const userInfoContainer = document.getElementById('user-info-container');
    const userInfoForm = document.getElementById('user-info-form');
    const checklistArea = document.getElementById('checklist-area');
    const taskListContainer = document.getElementById('task-list-container');
    const progressStickyWrapper = document.getElementById('progress-bar-sticky-wrapper');
    const progressContainer = document.getElementById('checklist-progress-container');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const progressLabel = document.getElementById('progress-bar-label');
    const resetBtn = document.getElementById('reset-checklist-btn');
    const incompleteBtn = document.getElementById('incomplete-handover-btn');
    
    const completionModal = document.getElementById('completion-modal');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const incompleteModal = document.getElementById('incomplete-modal');
    const closeIncompleteModalBtn = document.getElementById('close-incomplete-modal-btn');

    let currentShift = null;
    let workerInfo = {};
    const shiftInfo = {
        open: { label: 'ğŸŒ ì˜¤í”ˆ', color: 'bg-yellow-400', start: '07:00', end: '15:00' },
        middle: { label: 'ğŸŒ¥ï¸ ë¯¸ë“¤', color: 'bg-sky-400', start: '11:00', end: '15:00' },
        closing: { label: 'ğŸŒœ ë§ˆê°', color: 'bg-indigo-400', start: '15:00', end: '23:00' },
        'late-night': { label: 'â­ ì‹¬ì•¼', color: 'bg-gray-600', start: '23:00', end: '07:00' }
    };

    document.getElementById('work-date').valueAsDate = new Date();

    userInfoForm.addEventListener('change', (e) => {
        if (e.target.name === 'shift') {
            const selectedShift = e.target.value;
            document.getElementById('start-time').value = shiftInfo[selectedShift].start;
            document.getElementById('end-time').value = shiftInfo[selectedShift].end;
        }
    });

    userInfoForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const selectedShiftRadio = userInfoForm.querySelector('input[name="shift"]:checked');
        if (!selectedShiftRadio) {
            alert('ê·¼ë¬´ íƒ€ì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }
        const selectedShift = selectedShiftRadio.value;
        workerInfo = {
            name: document.getElementById('worker-name').value,
            date: document.getElementById('work-date').value,
            startTime: document.getElementById('start-time').value,
            endTime: document.getElementById('end-time').value,
        };
        startShift(selectedShift);
    });

    function startShift(shift) {
        currentShift = shift;
        userInfoContainer.classList.add('hidden');
        checklistArea.classList.remove('hidden');
        progressLabel.textContent = shiftInfo[shift].label;
        progressBar.className = `progress-bar ${shiftInfo[shift].color}`;
        generateTaskCards(shift);
        updateProgress();
    }

    function resetAll() {
        currentShift = null;
        workerInfo = {};
        userInfoForm.reset();
        document.getElementById('work-date').valueAsDate = new Date();
        checklistArea.classList.add('hidden');
        userInfoContainer.classList.remove('hidden');
        taskListContainer.innerHTML = '';
        progressContainer.classList.remove('sticky');
    }
    
    function generateTaskCards(shift) {
        taskListContainer.innerHTML = '';
        const tasksToRender = [...checklistData.common, ...checklistData[shift]];
        const groups = {};

        tasksToRender.forEach((taskItem, index) => {
            if (!groups[taskItem.group]) groups[taskItem.group] = [];
            groups[taskItem.group].push({ ...taskItem, originalIndex: index });
        });

        for (const groupName in groups) {
            const groupContainer = document.createElement('div');
            groupContainer.className = 'task-group';
            groupContainer.dataset.groupName = groupName;
            
            const groupHeader = document.createElement('h3');
            groupHeader.className = 'task-group-header text-lg font-bold text-[#8D6E63] mt-4 mb-2 sticky bg-[#FDFBF8] py-2 z-10 flex justify-between items-center';
            const groupTitle = document.createElement('span');
            groupTitle.textContent = groupName;
            const groupCounter = document.createElement('span');
            groupCounter.className = 'text-sm font-medium text-gray-500';
            groupHeader.appendChild(groupTitle);
            groupHeader.appendChild(groupCounter);
            groupContainer.appendChild(groupHeader);
            
            groups[groupName].forEach(taskItem => {
                const card = document.createElement('div');
                card.className = 'task-card';
                card.dataset.id = `${shift}-${taskItem.originalIndex}`;
                
                const labelContainer = document.createElement('div');
                labelContainer.className = 'task-main flex-grow';

                const label = document.createElement('label');
                label.htmlFor = `task-${shift}-${taskItem.originalIndex}`;
                label.className = 'text-gray-700';
                label.innerHTML = taskItem.task;
                labelContainer.appendChild(label);
                
                if(taskItem.description){
                    const description = document.createElement('p');
                    description.className = 'task-description';
                    description.textContent = taskItem.description;
                    labelContainer.appendChild(description);
                }

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `task-${shift}-${taskItem.originalIndex}`;
                checkbox.className = 'custom-checkbox ml-4';
                
                card.appendChild(labelContainer);
                card.appendChild(checkbox);
                groupContainer.appendChild(card);
            });
            taskListContainer.appendChild(groupContainer);
        }
    }
    
    function updateProgress() {
        if (!currentShift) return;
        const allTasks = taskListContainer.querySelectorAll('.task-card');
        const completedTasks = taskListContainer.querySelectorAll('.task-card.completed').length;
        const totalTasks = allTasks.length;
        const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
        progressBar.style.width = `${percentage}%`;
        progressText.textContent = `${percentage}%`;

        updateGroupCountersAndOrder();

        if (percentage === 100 && allTasks.length > 0) {
            // A short delay to allow the last animation to finish
            setTimeout(showCompletionModal, 500);
        }
    }
    
    function updateGroupCountersAndOrder() {
        const groupContainers = taskListContainer.querySelectorAll('.task-group');
        groupContainers.forEach(container => {
            const tasksInGroup = container.querySelectorAll('.task-card');
            const completedInGroup = container.querySelectorAll('.task-card.completed');
            const counter = container.querySelector('.task-group-header span:last-child');
            counter.textContent = `(${completedInGroup.length} / ${tasksInGroup.length})`;
            
            if (tasksInGroup.length > 0) {
               container.style.order = (tasksInGroup.length === completedInGroup.length) ? 1 : 0;
            }
        });
    }

    function handleTaskCheck(e) {
        if (e.target.matches('input[type="checkbox"]')) {
            const card = e.target.closest('.task-card');
            card.classList.toggle('completed', e.target.checked);
            
            const group = card.parentElement;
            if(e.target.checked) {
                // Move to the end of the group
                group.appendChild(card);
            } else {
                // Move to the beginning of the group
                group.insertBefore(card, group.querySelector('.task-card:not(.completed)'));
            }

            updateProgress();
        }
    }
    
    const observer = new IntersectionObserver(
        ([e]) => {
            progressContainer.classList.toggle('sticky', e.intersectionRatio < 1);
        },
        { threshold: [1], rootMargin: "-65px 0px 0px 0px" }
    );
    if(progressStickyWrapper) observer.observe(progressStickyWrapper);

    function showCompletionModal() {
        document.getElementById('modal-worker-name').textContent = workerInfo.name;
        document.getElementById('modal-work-date').textContent = workerInfo.date;
        document.getElementById('modal-work-time').textContent = `${workerInfo.startTime} - ${workerInfo.endTime}`;
        completionModal.classList.remove('hidden');
        setTimeout(() => completionModal.classList.remove('opacity-0'), 10);
        createConfetti();
    }

    function hideCompletionModal() {
        completionModal.classList.add('opacity-0');
        setTimeout(() => {
            completionModal.classList.add('hidden');
            resetAll();
        }, 300);
    }
    
    function showIncompleteModal() {
        const allTasks = Array.from(taskListContainer.querySelectorAll('.task-card'));
        const completedTasks = allTasks.filter(t => t.classList.contains('completed')).length;
        const totalTasks = allTasks.length;
        const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
        
        let message = "ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤! ë‹¤ìŒ ê·¼ë¬´ìì—ê²Œ ì¸ìˆ˜ì¸ê³„ ì˜ ë¶€íƒë“œë ¤ìš”.";
        if (percentage >= 80) message = "ê±°ì˜ ë‹¤ í–ˆì–´ìš”! ì •ë§ ëŒ€ë‹¨í•´ìš”! ë‚¨ì€ ì—…ë¬´ëŠ” ì˜ ì¸ê³„í•´ì£¼ì„¸ìš”.";
        else if (percentage >= 50) message = "ì ˆë°˜ ì´ìƒ í•´ëƒˆë„¤ìš”! ê³ ìƒ ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤.";
        else message = "ë°”ìœ í•˜ë£¨ì˜€ë„¤ìš”. ì•„ì‰½ì§€ë§Œ ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!";

        document.getElementById('incomplete-modal-worker-name').textContent = workerInfo.name;
        document.getElementById('incomplete-modal-work-date').textContent = workerInfo.date;
        document.getElementById('incomplete-modal-work-time').textContent = `${workerInfo.startTime} - ${workerInfo.endTime}`;
        document.getElementById('incomplete-message').textContent = message;
        document.getElementById('incomplete-percentage').textContent = percentage;

        const listEl = document.querySelector('#incomplete-tasks-list ul');
        listEl.innerHTML = '';
        const uncompletedTasks = allTasks.filter(t => !t.classList.contains('completed'));
        if(uncompletedTasks.length === 0){
            listEl.innerHTML = '<li>ëª¨ë“  ì—…ë¬´ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!</li>';
        } else {
            uncompletedTasks.forEach(task => {
                const li = document.createElement('li');
                li.innerHTML = task.querySelector('.task-main label').innerHTML;
                listEl.appendChild(li);
            });
        }

        incompleteModal.classList.remove('hidden');
        setTimeout(() => incompleteModal.classList.remove('opacity-0'), 10);
    }

    function hideIncompleteModal() {
         incompleteModal.classList.add('opacity-0');
        setTimeout(() => {
            incompleteModal.classList.add('hidden');
            resetAll();
        }, 300);
    }

    function createConfetti() {
        const container = document.getElementById('confetti-container');
        container.innerHTML = '';
        const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800'];
        for (let i = 0; i < 100; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = `${Math.random() * 100}vw`;
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.animationDelay = `${Math.random() * 2}s`;
            confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
            container.appendChild(confetti);
        }
    }
    
    // Event Listeners
    mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
    resetBtn.addEventListener('click', resetAll);
    taskListContainer.addEventListener('change', handleTaskCheck);
    closeModalBtn.addEventListener('click', hideCompletionModal);
    incompleteBtn.addEventListener('click', showIncompleteModal);
    closeIncompleteModalBtn.addEventListener('click', hideIncompleteModal);

    // Initial load
    // initializeChecklistApp() is implicitly run by being in the main script scope.
});
</script>
</body>
</html>
