<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>백억커피 통합 운영 매뉴얼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #FDFBF8;
        }
        .main-category-card {
            transition: all 0.3s ease;
            border: 1px solid #EAE2DA;
        }
        .main-category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-color: #8D6E63;
            background-color: #FBF9F6;
        }
        .recipe-card {
            transition: all 0.3s ease;
            border: 1px solid #EAE2DA;
        }
        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-color: #D1C3B4;
        }
        .category-btn.active {
            background-color: #8D6E63;
            color: white;
            font-weight: 700;
        }
        #mobile-category-nav .category-btn.active {
             border-color: #8D6E63;
             color: #8D6E63;
             background-color: #F1EBE5;
        }
        .version-btn.active {
            background-color: #A1887F;
            color: white;
        }
        .ingredient-block {
            display: inline-block;
            background-color: #F8F5F2;
            border-radius: 6px;
            padding: 4px 8px;
            margin: 2px;
            font-size: 1rem;
            line-height: 1.5rem;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .gnb-btn.active { background-color: #8D6E63; color: white; }
        
        /* --- Checklist Styles --- */
        #checklist-progress-container.sticky {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        #checklist-progress-container .details-wrapper {
             max-height: 100px; /* give it a large max-height to animate from */
             transition: max-height 0.3s ease-in-out, margin-bottom 0.3s ease-in-out, opacity 0.3s ease-in-out;
             overflow: hidden;
        }
        #checklist-progress-container.sticky .details-wrapper {
            max-height: 0;
            margin-bottom: 0 !important;
            opacity: 0;
        }
        .progress-bar-wrapper {
            flex-grow: 1; background-color: #e5e7eb; border-radius: 9999px; height: 1.25rem; overflow: hidden;
            transition: height 0.3s ease-in-out;
        }
        #checklist-progress-container.sticky .progress-bar-wrapper {
            height: 0.75rem;
        }
        .progress-bar {
            height: 100%; border-radius: 9999px; transition: width 0.3s ease-in-out;
        }
        .task-card {
            display: flex; align-items: center; background-color: white; border: 1px solid #EAE2DA; border-radius: 0.5rem;
            padding: 1rem; transition: all 0.3s ease-in-out; margin-bottom: 0.75rem;
        }
        .task-card.completed {
            opacity: 0.6; background-color: #f3f4f6;
        }
        .task-card.completed .task-main label {
            text-decoration: line-through;
        }
        .task-description {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
            padding-left: 0.25rem;
        }
        .task-group-header {
            top: 108px; /* Calculated sticky top: 64px (GNB) + ~44px (shrunken progress bar) */
        }
        .custom-checkbox {
            appearance: none; -webkit-appearance: none;
            min-width: 1.5rem; width: 1.5rem; height: 1.5rem;
            border: 2px solid #D1C3B4; border-radius: 0.375rem;
            cursor: pointer; display: grid; place-content: center;
        }
        .custom-checkbox::before {
            content: ""; width: 0.8rem; height: 0.8rem;
            transform: scale(0); transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em #8D6E63;
            transform-origin: bottom left; clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
        .custom-checkbox:checked::before {
            transform: scale(1);
        }
        
        /* Modal Styles */
        .modal-backdrop { transition: opacity 0.3s ease; }
        .modal-content { animation: zoomIn 0.3s ease forwards; }
        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        /* Confetti Animation */
        .confetti {
            width: 10px; height: 10px; background-color: #f00;
            position: absolute; top: 0; animation: fall 3s linear forwards;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* Improved Form Styles */
        .shift-btn-radio { display: none; }
        .shift-btn-radio + label {
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: 2px solid transparent;
        }
        .shift-btn-radio:checked + label {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-color: #6D4C41;
        }
    </style>
</head>
<body class="text-gray-800">

    <header id="main-gnb" class="bg-white shadow-md sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <button class="gnb-btn font-bold text-xl text-[#6D4C41] active hidden md:flex items-center" data-view="home-view">
                        <i class="fas fa-home mr-2"></i>백억커피 매뉴얼
                    </button>
                    <button class="gnb-btn flex md:hidden items-center space-x-2 active" data-view="home-view">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSmgK7X5UjYipj8B0revMEDlmBiNaoJfIDfpw&s" class="h-8 w-auto" alt="백억커피 로고">
                        <span class="font-bold text-lg text-[#6D4C41]">매뉴얼</span>
                    </button>
                </div>
                <div class="hidden md:flex items-center">
                    <div class="relative mr-4">
                        <input type="text" id="global-search-input" placeholder="통합 검색..." class="w-48 lg:w-64 px-3 py-2 pl-10 text-sm border border-[#D7CCC8] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#A1887F] transition duration-200">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                    <div class="flex items-baseline space-x-4">
                        <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium" data-view="system-view">시스템</button>
                        <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium" data-view="inventory-view">발주/재고</button>
                        <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium" data-view="status-view">메뉴관리</button>
                        <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium" data-view="cleaning-view">청소</button>
                        <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium" data-view="checklist-view">체크리스트</button>
                        <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium" data-view="recipe-view">레시피</button>
                    </div>
                </div>
                <div class="flex items-center md:hidden">
                    <div class="relative">
                        <input type="text" id="global-search-input-mobile" placeholder="레시피 검색..." class="w-36 sm:w-48 px-3 py-1.5 pl-8 text-sm border border-[#D7CCC8] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#A1887F] transition duration-200">
                        <i class="fas fa-search absolute left-2.5 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                    <button type="button" id="mobile-menu-button" class="ml-2 p-2 rounded-md text-gray-500 hover:text-gray-800 hover:bg-gray-100 focus:outline-none">
                        <span class="sr-only">Open main menu</span>
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="md:hidden hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium w-full text-left" data-view="system-view">시스템 관리</button>
                <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium w-full text-left" data-view="inventory-view">발주 및 재고 관리</button>
                <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium w-full text-left" data-view="status-view">메뉴 품절/해제 관리</button>
                <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium w-full text-left" data-view="cleaning-view">매장 청소 및 분리배출</button>
                <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium w-full text-left" data-view="checklist-view">체크리스트</button>
                <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium w-full text-left" data-view="recipe-view">레시피 목록</button>
            </div>
        </div>
    </header>

    <div id="app-container">
        <!-- Home View -->
        <div id="home-view">
            <main class="p-4 sm:p-8">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
                    <div class="main-category-card bg-white rounded-lg shadow-sm p-6 cursor-pointer text-center" data-view="system-view"><i class="fas fa-desktop fa-3x text-[#A1887F] mb-4"></i><h2 class="text-xl font-bold text-[#6D4C41]">시스템 관리</h2><p class="text-gray-500 mt-1">포스, 배달앱</p></div>
                    <div class="main-category-card bg-white rounded-lg shadow-sm p-6 cursor-pointer text-center" data-view="inventory-view"><i class="fas fa-boxes fa-3x text-[#A1887F] mb-4"></i><h2 class="text-xl font-bold text-[#6D4C41]">발주 및 재고 관리</h2><p class="text-gray-500 mt-1">주문, 재고 확인</p></div>
                    <div class="main-category-card bg-white rounded-lg shadow-sm p-6 cursor-pointer text-center" data-view="status-view"><i class="fas fa-toggle-on fa-3x text-[#A1887F] mb-4"></i><h2 class="text-xl font-bold text-[#6D4C41]">메뉴 품절/해제 관리</h2><p class="text-gray-500 mt-1">메뉴 상태 변경</p></div>
                    <div class="main-category-card bg-white rounded-lg shadow-sm p-6 cursor-pointer text-center" data-view="cleaning-view"><i class="fas fa-broom fa-3x text-[#A1887F] mb-4"></i><h2 class="text-xl font-bold text-[#6D4C41]">매장 청소 및 분리배출</h2><p class="text-gray-500 mt-1">청결 관리</p></div>
                    <div class="main-category-card bg-white rounded-lg shadow-sm p-6 cursor-pointer text-center" data-view="checklist-view"><i class="fas fa-clipboard-list fa-3x text-[#A1887F] mb-4"></i><h2 class="text-xl font-bold text-[#6D4C41]">근무 교대 체크리스트</h2><p class="text-gray-500 mt-1">인수인계 항목</p></div>
                    <div class="main-category-card bg-white rounded-lg shadow-sm p-6 cursor-pointer text-center" data-view="recipe-view"><i class="fas fa-book-open fa-3x text-[#A1887F] mb-4"></i><h2 class="text-xl font-bold text-[#6D4C41]">레시피 목록</h2><p class="text-gray-500 mt-1">음료, 푸드 제조법</p></div>
                </div>
            </main>
        </div>

        <!-- Detail Views (Initially Hidden) -->
        <div id="detail-views" class="hidden">
            <div id="system-view" class="p-8"><h1 class="text-3xl font-bold text-[#6D4C41] mb-4">시스템 (포스, 배달앱) 관리</h1><p class="text-gray-700">시스템 관리 더미 데이터입니다. 여기에 포스기 사용법, 배달앱 주문 처리 방법 등에 대한 내용을 추가할 수 있습니다.</p></div>
            <div id="inventory-view" class="p-8"><h1 class="text-3xl font-bold text-[#6D4C41] mb-4">발주 및 재고 관리</h1><p class="text-gray-700">발주 및 재고 관리 더미 데이터입니다. 여기에 주간 발주 목록, 재고 확인 방법, 유통기한 관리 등에 대한 내용을 추가할 수 있습니다.</p></div>
            <div id="status-view" class="p-8"><h1 class="text-3xl font-bold text-[#6D4C41] mb-4">메뉴 품절 / 품절 해제 관리</h1><p class="text-gray-700">메뉴 품절/해제 관리 더미 데이터입니다. 여기에 각 배달앱 및 포스에서 메뉴 상태를 변경하는 방법에 대한 내용을 추가할 수 있습니다.</p></div>
            <div id="cleaning-view" class="p-8"><h1 class="text-3xl font-bold text-[#6D4C41] mb-4">매장 청소 및 분리배출 관리</h1><p class="text-gray-700">매장 청소 및 분리배출 관리 더미 데이터입니다. 여기에 일간/주간 청소 체크리스트, 분리배출 요령 등에 대한 내용을 추가할 수 있습니다.</p></div>
            
            <div id="checklist-view" class="p-4 sm:p-8 max-w-4xl mx-auto">
                <h1 class="text-3xl font-bold text-[#6D4C41] mb-8 text-center">근무 교대 체크리스트</h1>
                
                <!-- Combined User Info and Shift Selection Form -->
                <div id="user-info-container">
                    <form id="user-info-form" class="bg-white rounded-lg shadow-md p-6 space-y-6">
                        <h2 class="text-xl font-semibold text-center text-gray-700">근무 정보를 입력하고 시작하세요.</h2>
                        
                        <div>
                            <label for="worker-name" class="block text-sm font-medium text-gray-700 mb-1">이름</label>
                            <input type="text" id="worker-name" required class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#A1887F] focus:border-[#A1887F] sm:text-sm">
                        </div>
                        
                        <div>
                            <label for="work-date" class="block text-sm font-medium text-gray-700 mb-1">날짜</label>
                            <input type="date" id="work-date" required class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#A1887F] focus:border-[#A1887F] sm:text-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">근무 타임</label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <input type="radio" name="shift" id="shift-open" value="open" class="shift-btn-radio" required>
                                <label for="shift-open" class="block text-center bg-yellow-400 text-white font-bold py-3 rounded-lg shadow-md">🌞 오픈</label>
                                
                                <input type="radio" name="shift" id="shift-middle" value="middle" class="shift-btn-radio">
                                <label for="shift-middle" class="block text-center bg-sky-400 text-white font-bold py-3 rounded-lg shadow-md">🌥️ 미들</label>
                                
                                <input type="radio" name="shift" id="shift-closing" value="closing" class="shift-btn-radio">
                                <label for="shift-closing" class="block text-center bg-indigo-400 text-white font-bold py-3 rounded-lg shadow-md">🌜 마감</label>

                                <input type="radio" name="shift" id="shift-late-night" value="late-night" class="shift-btn-radio">
                                <label for="shift-late-night" class="block text-center bg-gray-600 text-white font-bold py-3 rounded-lg shadow-md">⭐ 심야</label>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="start-time" class="block text-sm font-medium text-gray-700 mb-1">시작 시간</label>
                                <input type="time" id="start-time" required class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#A1887F] focus:border-[#A1887F] sm:text-sm">
                            </div>
                            <div>
                                <label for="end-time" class="block text-sm font-medium text-gray-700 mb-1">종료 시간</label>
                                <input type="time" id="end-time" required class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#A1887F] focus:border-[#A1887F] sm:text-sm">
                            </div>
                        </div>
                        <button type="submit" class="w-full bg-[#8D6E63] text-white font-bold py-3 px-4 rounded-lg hover:bg-[#A1887F] transition-all">체크리스트 시작</button>
                    </form>
                </div>

                <!-- Checklist Area -->
                <div id="checklist-area" class="hidden">
                    <div class="sticky top-[64px] z-20" id="progress-bar-sticky-wrapper">
                        <div id="checklist-progress-container" class="bg-white rounded-lg p-6 mb-6 transition-all duration-300">
                            <div class="details-wrapper mb-4">
                                <div class="flex justify-between items-center">
                                    <h2 id="progress-title" class="text-xl font-bold text-[#6D4C41]">업무 완료 현황</h2>
                                    <button id="reset-checklist-btn" class="text-sm text-gray-500 hover:text-gray-800 transition-colors"><i class="fas fa-undo mr-1"></i>처음으로</button>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div id="progress-bar-label" class="w-20 text-center font-semibold text-gray-700 shrink-0"></div>
                                <div class="progress-bar-wrapper"><div id="progress-bar" class="progress-bar" style="width: 0%;"></div></div>
                                <span id="progress-text" class="w-12 text-right font-medium text-gray-700 text-lg shrink-0">0%</span>
                            </div>
                        </div>
                    </div>
                    <div id="task-list-container" class="flex flex-col relative z-10"></div>
                    <button id="incomplete-handover-btn" class="mt-6 w-full bg-gray-500 text-white font-bold py-3 px-4 rounded-lg hover:bg-gray-600 transition-all">완료 없이 교대하기</button>
                </div>
            </div>
            <div id="recipe-view"></div>
        </div>
    </div>
    
    <!-- Modals -->
    <div id="completion-modal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div id="confetti-container" class="absolute inset-0 overflow-hidden"></div>
        <div class="modal-content bg-white rounded-2xl shadow-2xl p-6 sm:p-8 max-w-md w-full text-center relative transform opacity-0">
            <h2 class="text-3xl sm:text-4xl font-bold text-[#8D6E63] mb-4">🎉 교대 준비 완료! 🎉</h2>
            <div class="bg-gray-100 rounded-lg p-4 mb-6 text-left text-sm text-gray-600">
                <p><strong class="w-16 inline-block">근무자:</strong> <span id="modal-worker-name"></span></p>
                <p><strong class="w-16 inline-block">날짜:</strong> <span id="modal-work-date"></span></p>
                <p><strong class="w-16 inline-block">근무시간:</strong> <span id="modal-work-time"></span></p>
            </div>
            <p class="text-gray-700 text-lg mb-6">오늘 하루도 수고 많으셨어요! 👏</p>
            <p class="bg-amber-100 text-amber-800 font-semibold p-4 rounded-lg"><i class="fas fa-camera mr-2"></i>이 화면을 캡처하여 단톡방에 올려주세요.</p>
            <button id="close-modal-btn" class="mt-8 bg-[#8D6E63] text-white font-bold py-2 px-6 rounded-lg hover:bg-[#A1887F] transition-all">닫기</button>
        </div>
    </div>
    
    <div id="incomplete-modal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div class="modal-content bg-white rounded-2xl shadow-2xl p-6 sm:p-8 max-w-md w-full text-center relative transform opacity-0">
            <h2 class="text-3xl sm:text-4xl font-bold text-[#8D6E63] mb-4">📝 인수인계서</h2>
            <div class="bg-gray-100 rounded-lg p-4 mb-4 text-left text-sm text-gray-600">
                <p><strong class="w-16 inline-block">근무자:</strong> <span id="incomplete-modal-worker-name"></span></p>
                <p><strong class="w-16 inline-block">날짜:</strong> <span id="incomplete-modal-work-date"></span></p>
                <p><strong class="w-16 inline-block">근무시간:</strong> <span id="incomplete-modal-work-time"></span></p>
            </div>
            <p id="incomplete-message" class="text-gray-700 text-lg mb-4"></p>
            <p class="text-2xl font-bold mb-4">총 <span id="incomplete-percentage"></span>% 완료</p>
            <div id="incomplete-tasks-list" class="text-left bg-red-50 border border-red-200 rounded-lg p-4 max-h-48 overflow-y-auto">
                <h3 class="font-bold text-red-800 mb-2">미완료 업무:</h3>
                <ul class="list-disc list-inside text-red-700 text-sm space-y-1"></ul>
            </div>
            <p class="mt-6 bg-amber-100 text-amber-800 font-semibold p-4 rounded-lg"><i class="fas fa-camera mr-2"></i>이 화면을 캡처하여 인수인계 해주세요.</p>
            <button id="close-incomplete-modal-btn" class="mt-6 bg-[#8D6E63] text-white font-bold py-2 px-6 rounded-lg hover:bg-[#A1887F] transition-all">닫기</button>
        </div>
    </div>


<script>
const recipeData = [
    // This data is intentionally omitted for brevity as it's unchanged.
    { category: '푸드', name: '바삭 감자 치즈볼 (5ea)', image: "https://placehold.co/600x400/FFD700/FFFFFF?text=Potato+Cheese+Ball", versions: { '조리법': { ingredients:['치즈볼 5개', '케찹 40g'], instructions: ["해동 없이 에어프라이기 6분", "샌드위치 용기에 담아 케찹과 함께 제공", "조리 후 최소 30초 공기와 접촉 후 뚜껑 닫기"] } } },
    { category: '팝콘', name: '카라멜 팝콘', image: "https://placehold.co/600x400/DAA520/FFFFFF?text=Caramel+Popcorn", versions: { '조리법': { ingredients: ['팝콘 옥수수: 1 CUP', '팝콘 오일: 150ml', '카라멜 시즈닝: 180ml'], instructions: ['모터와 히터를 함께 ON 합니다.', '오일 → 시즈닝 → 옥수수 순으로 넣습니다.', '팝콘이 20개 정도 터지면 히터를 OFF 합니다.', '소리가 멈추면 모터를 끄고 정리합니다.'] } } },
    { category: '팝콘', name: '딸기 팝콘', image: "https://placehold.co/600x400/FFC0CB/FFFFFF?text=Strawberry+Popcorn", versions: { '조리법': { ingredients: ["팝콘 옥수수: 1.5 CUP", "팝콘 오일: 1 CUP", "카라멜 시즈닝: 1.2 CUP"], instructions: ["카라멜 팝콘 조리법과 동일합니다."] } } }
];

const checklistData = {
    common: [
        { group: '출근 시', task: '조명 / 어닝 / DID 모니터 확인' },
        { group: '출근 시', task: '배달 어플 확인' },
        { group: '출근 시', task: '시재 인수인계 및 전달사항 확인' },
        { group: '출근 시', task: '제빙기 얼음양 확인' },
        { group: '교체 시', task: '<span class="font-bold">원두:</span> 그라인더 호퍼 분리 후 청소' },
        { group: '교체 시', task: '<span class="font-bold">시럽:</span> 굳지 않도록 뜨거운 물 빼주기' },
        { group: '채워주기', task: '각종 부자재 및 소모품', description: '팝콘, 나쵸, 대용량 베이스, 가당딸기, 냉장해동 디저트, 오징어, 2온스 소스통, 시럽, 파우더 등' },
        { group: '퇴근 한 시간 전', task: '쓰레기 및 청결 상태 확인', description: '커피퍽, 쓰레기통, 싱크대, 우유곽, 배수구 확인 및 교체' },
        { group: '퇴근 한 시간 전', task: '기기 청소', description: '자동 탬핑기 내부 브러쉬 청소, 실링기 오염 제거' },
        { group: '퇴근 한 시간 전', task: '커피 바 전체 정리 및 청소' },
        { group: '퇴근 한 시간 전', task: '소도구 정리', description: '찐딸기용 계량스푼 물 교체, 행주/스팀행주 세척' },
        { group: '퇴근 한 시간 전', task: '시재 확인 및 인수인계 사항 남기기' },
    ],
    open: [
        { group: '오픈 업무', task: '픽업대 및 포스기 주변 정리 및 청소' },
        { group: '오픈 업무', task: '행주 세척' },
        { group: '오픈 업무', task: '재고 정리 및 확인', description: '냉장/상온/실온 정리 및 선입선출 확인, 재고 및 발주 확인' },
        { group: '마감 청소', task: '<span class="font-semibold">(매일)</span> 상부/대용량 냉장고 물기 제거' },
        { group: '마감 청소', task: '<span class="font-semibold">(매일)</span> 파우더 선반, 시럽병 근처 바닥 청소' },
        { group: '마감 청소', task: '<span class="font-semibold">(매일)</span> 파우더 스푼 세척 및 건조' },
        { group: '마감 청소', task: '<span class="font-semibold">(월,수,금)</span> 싱크대 물때 청소' },
        { group: '마감 청소', task: '<span class="font-semibold">(화)</span> 오거나이저 빈, 팝콘 기계 뒤쪽 청소' },
        { group: '마감 청소', task: '<span class="font-semibold">(목)</span> 창문틀, 키오스크 양쪽 먼지 제거' },
    ],
    middle: [
        { group: '미들 업무', task: '매장 외부 청소', description: '매장 밖, 문 앞 청소 (명함, 쓰레기 등)' },
        { group: '미들 업무', task: '중간 쓰레기 처리', description: '영수증 쓰레기통, 커피 퍽 비우기' },
        { group: '미들 업무', task: '전체 바닥 청소' },
        { group: '마감 청소', task: '<span class="font-semibold">(매일)</span> 아이스빈 및 서랍 내부 청소' },
        { group: '마감 청소', task: '<span class="font-semibold">(매일)</span> 빙수기계, 디퍼웰, 소도구 세척' },
    ],
    closing: [
        { group: '마감/저녁 업무', task: '<span class="font-bold">[18:00-20:00]</span> 리뷰 댓글 달기' },
        { group: '마감/저녁 업무', task: '<span class="font-bold">[20:30]</span> 심야 대비 재료 확인', description: '볶음밥/강정 등 심야 시간대 재료 소분 및 준비' },
        { group: '마감 청소 - 커피머신', task: '<span class="font-semibold">(매일)</span> 그룹헤드 청소', description: '솔 청소 및 물 흘리기' },
        { group: '마감 청소 - 커피머신', task: '<span class="font-semibold">(매일)</span> 포터필터 및 트레이 세척', description: '용액 세척, 트레이 분리 세척' },
        { group: '마감 청소 - 커피머신', task: '<span class="font-semibold">(매일)</span> 커피머신 주변기기 청소', description: '머신 전체, 그라인더, 탬핑기 청소' },
        { group: '마감 청소 - 커피머신', task: '<span class="font-semibold">(매일)</span> 온수기 청소', description: '홀더상자, 물 입출구, 코크 손잡이 청소' },
        { group: '마감 청소 - 커피머신', task: '<span class="font-semibold">(매일)</span> 조리기구 세척', description: '에어프라이어 망, 전자레인지용 접시 세척' },
    ],
    'late-night': [
        { group: '심야 업무', task: '영업 종료 준비', description: '어닝 접기, 시재 정리, 포스 마감 및 보고' },
        { group: '심야 업무', task: '물류 입고 확인 및 정리 (불량 체크)' },
        { group: '심야 업무', task: '<span class="font-bold">[평일]</span> 포장재 미리 준비', description: '핫도그박스, 오징어상자, 캔/케이크 스티커 등' },
        { group: '05:00 마감청소', task: '<span class="font-semibold">(매일)</span> 조리/제조 도구 마감', description: '에어프라이어, 접시, 바스푼통, 디퍼웰 마감' },
        { group: '05:00 마감청소', task: '<span class="font-semibold">(매일)</span> 모든 쓰레기 배출' },
        { group: '05:00 마감청소', task: '<span class="font-semibold">(매일)</span> 창고 및 냉장고 아래 청소' },
        { group: '05:00 마감청소', task: '<span class="font-semibold">(매일)</span> 전체 바닥 쓸고 닦기', description: '창고 → 커피바 → 홀 순서' },
        { group: '05:00 마감청소', task: '<span class="font-semibold">(매일)</span> 청소도구 정리', description: '대걸레 세척, 스팀행주 세척 및 건조' },
        { group: '05:00 마감청소', task: '<span class="font-semibold">(매일)</span> 기타 용품 세척', description: '영수증 통 세척 및 건조, 일반행주 세제에 담궈두기' },
        { group: '05:00 마감청소', task: '<span class="font-semibold">(월,수,금)</span> 쓰레기통 세척', description: '음식물 쓰레기통, 분리수거함 세척' },
    ]
};


document.addEventListener('DOMContentLoaded', () => {
    // Basic Element Selectors
    const homeView = document.getElementById('home-view');
    const detailViewsContainer = document.getElementById('detail-views');
    const mainCategoryCards = document.querySelectorAll('.main-category-card');
    const gnb = document.getElementById('main-gnb');
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const globalSearchInput = document.getElementById('global-search-input');
    const globalSearchInputMobile = document.getElementById('global-search-input-mobile');
    
    // View Switching Function
    function showView(viewId) {
        if (viewId === 'home-view') {
            homeView.style.display = 'block';
            detailViewsContainer.classList.add('hidden');
        } else {
            homeView.style.display = 'none';
            detailViewsContainer.classList.remove('hidden');
            document.querySelectorAll('#detail-views > div').forEach(view => {
                view.style.display = 'none';
            });
            const targetView = document.getElementById(viewId);
            if (targetView) targetView.style.display = 'block';
        }
        document.querySelectorAll('.gnb-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll(`.gnb-btn[data-view="${viewId}"]`).forEach(btn => btn.classList.add('active'));
        mobileMenu.classList.add('hidden');
    }

    // --- Checklist App ---
    function initializeChecklistApp() {
        const userInfoContainer = document.getElementById('user-info-container');
        const userInfoForm = document.getElementById('user-info-form');
        const checklistArea = document.getElementById('checklist-area');
        const taskListContainer = document.getElementById('task-list-container');
        const progressStickyWrapper = document.getElementById('progress-bar-sticky-wrapper');
        const progressContainer = document.getElementById('checklist-progress-container');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const progressLabel = document.getElementById('progress-bar-label');
        const resetBtn = document.getElementById('reset-checklist-btn');
        const incompleteBtn = document.getElementById('incomplete-handover-btn');
        
        const completionModal = document.getElementById('completion-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const incompleteModal = document.getElementById('incomplete-modal');
        const closeIncompleteModalBtn = document.getElementById('close-incomplete-modal-btn');

        let currentShift = null;
        let workerInfo = {};
        const shiftInfo = {
            open: { label: '🌞 오픈', color: 'bg-yellow-400', start: '07:00', end: '15:00' },
            middle: { label: '🌥️ 미들', color: 'bg-sky-400', start: '11:00', end: '15:00' },
            closing: { label: '🌜 마감', color: 'bg-indigo-400', start: '15:00', end: '23:00' },
            'late-night': { label: '⭐ 심야', color: 'bg-gray-600', start: '23:00', end: '07:00' }
        };

        document.getElementById('work-date').valueAsDate = new Date();

        userInfoForm.addEventListener('change', (e) => {
            if (e.target.name === 'shift') {
                const selectedShift = e.target.value;
                document.getElementById('start-time').value = shiftInfo[selectedShift].start;
                document.getElementById('end-time').value = shiftInfo[selectedShift].end;
            }
        });

        userInfoForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const selectedShiftRadio = userInfoForm.querySelector('input[name="shift"]:checked');
            if (!selectedShiftRadio) {
                alert('근무 타임을 선택해주세요.');
                return;
            }
            const selectedShift = selectedShiftRadio.value;
            workerInfo = {
                name: document.getElementById('worker-name').value,
                date: document.getElementById('work-date').value,
                startTime: document.getElementById('start-time').value,
                endTime: document.getElementById('end-time').value,
            };
            startShift(selectedShift);
        });

        function startShift(shift) {
            currentShift = shift;
            userInfoContainer.classList.add('hidden');
            checklistArea.classList.remove('hidden');
            progressLabel.textContent = shiftInfo[shift].label;
            progressBar.className = `progress-bar ${shiftInfo[shift].color}`;
            generateTaskCards(shift);
            updateProgress();
        }

        function resetAll() {
            currentShift = null;
            workerInfo = {};
            userInfoForm.reset();
            document.getElementById('work-date').valueAsDate = new Date();
            checklistArea.classList.add('hidden');
            userInfoContainer.classList.remove('hidden');
            taskListContainer.innerHTML = '';
            progressContainer.classList.remove('sticky');
        }
        
        function generateTaskCards(shift) {
            taskListContainer.innerHTML = '';
            const tasksToRender = [...checklistData.common, ...checklistData[shift]];
            const groups = {};

            tasksToRender.forEach((taskItem, index) => {
                if (!groups[taskItem.group]) groups[taskItem.group] = [];
                groups[taskItem.group].push({ ...taskItem, originalIndex: index });
            });

            for (const groupName in groups) {
                const groupContainer = document.createElement('div');
                groupContainer.className = 'task-group';
                groupContainer.dataset.groupName = groupName;
                
                const groupHeader = document.createElement('h3');
                groupHeader.className = 'task-group-header text-lg font-bold text-[#8D6E63] mt-4 mb-2 sticky bg-[#FDFBF8] py-2 z-10 flex justify-between items-center';
                const groupTitle = document.createElement('span');
                groupTitle.textContent = groupName;
                const groupCounter = document.createElement('span');
                groupCounter.className = 'text-sm font-medium text-gray-500';
                groupHeader.appendChild(groupTitle);
                groupHeader.appendChild(groupCounter);
                groupContainer.appendChild(groupHeader);
                
                groups[groupName].forEach(taskItem => {
                    const card = document.createElement('div');
                    card.className = 'task-card';
                    card.dataset.id = `${shift}-${taskItem.originalIndex}`;
                    
                    const labelContainer = document.createElement('div');
                    labelContainer.className = 'task-main flex-grow';

                    const label = document.createElement('label');
                    label.htmlFor = `task-${shift}-${taskItem.originalIndex}`;
                    label.className = 'text-gray-700';
                    label.innerHTML = taskItem.task;
                    labelContainer.appendChild(label);
                    
                    if(taskItem.description){
                        const description = document.createElement('p');
                        description.className = 'task-description';
                        description.textContent = taskItem.description;
                        labelContainer.appendChild(description);
                    }

                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `task-${shift}-${taskItem.originalIndex}`;
                    checkbox.className = 'custom-checkbox ml-4';
                    
                    card.appendChild(labelContainer);
                    card.appendChild(checkbox);
                    groupContainer.appendChild(card);
                });
                taskListContainer.appendChild(groupContainer);
            }
        }
        
        function updateProgress() {
            if (!currentShift) return;
            const allTasks = taskListContainer.querySelectorAll('.task-card');
            const completedTasks = taskListContainer.querySelectorAll('.task-card.completed').length;
            const totalTasks = allTasks.length;
            const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `${percentage}%`;

            updateGroupCountersAndOrder();

            if (percentage === 100 && allTasks.length > 0) {
                showCompletionModal();
            }
        }
        
        function updateGroupCountersAndOrder() {
            const groupContainers = taskListContainer.querySelectorAll('.task-group');
            groupContainers.forEach(container => {
                const tasksInGroup = container.querySelectorAll('.task-card');
                const completedInGroup = container.querySelectorAll('.task-card.completed');
                const counter = container.querySelector('.task-group-header span:last-child');
                counter.textContent = `(${completedInGroup.length} / ${tasksInGroup.length})`;
                
                if (tasksInGroup.length > 0) {
                   container.style.order = (tasksInGroup.length === completedInGroup.length) ? 1 : 0;
                }
            });
        }

        function handleTaskCheck(e) {
            if (e.target.matches('input[type="checkbox"]')) {
                const card = e.target.closest('.task-card');
                card.classList.toggle('completed', e.target.checked);
                updateProgress();
            }
        }
        
        const observer = new IntersectionObserver(
            ([e]) => {
                progressContainer.classList.toggle('sticky', e.intersectionRatio < 1);
            },
            { threshold: [1], rootMargin: "-65px 0px 0px 0px" }
        );
        if(progressStickyWrapper) observer.observe(progressStickyWrapper);

        function showCompletionModal() {
            document.getElementById('modal-worker-name').textContent = workerInfo.name;
            document.getElementById('modal-work-date').textContent = workerInfo.date;
            document.getElementById('modal-work-time').textContent = `${workerInfo.startTime} - ${workerInfo.endTime}`;
            completionModal.classList.remove('hidden');
            setTimeout(() => completionModal.classList.remove('opacity-0'), 10);
            createConfetti();
        }

        function hideCompletionModal() {
            completionModal.classList.add('opacity-0');
            setTimeout(() => {
                completionModal.classList.add('hidden');
                resetAll();
            }, 300);
        }
        
        function showIncompleteModal() {
            const allTasks = Array.from(taskListContainer.querySelectorAll('.task-card'));
            const completedTasks = allTasks.filter(t => t.classList.contains('completed')).length;
            const totalTasks = allTasks.length;
            const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            let message = "수고하셨습니다! 다음 근무자에게 인수인계 잘 부탁드려요.";
            if (percentage >= 80) message = "거의 다 했어요! 정말 대단해요! 남은 업무는 잘 인계해주세요.";
            else if (percentage >= 50) message = "절반 이상 해냈네요! 고생 많으셨습니다.";
            else message = "바쁜 하루였네요. 아쉽지만 수고하셨습니다!";

            document.getElementById('incomplete-modal-worker-name').textContent = workerInfo.name;
            document.getElementById('incomplete-modal-work-date').textContent = workerInfo.date;
            document.getElementById('incomplete-modal-work-time').textContent = `${workerInfo.startTime} - ${workerInfo.endTime}`;
            document.getElementById('incomplete-message').textContent = message;
            document.getElementById('incomplete-percentage').textContent = percentage;

            const listEl = document.querySelector('#incomplete-tasks-list ul');
            listEl.innerHTML = '';
            const uncompletedTasks = allTasks.filter(t => !t.classList.contains('completed'));
            if(uncompletedTasks.length === 0){
                listEl.innerHTML = '<li>모든 업무를 완료했습니다!</li>';
            } else {
                uncompletedTasks.forEach(task => {
                    const li = document.createElement('li');
                    li.innerHTML = task.querySelector('.task-main label').innerHTML;
                    listEl.appendChild(li);
                });
            }

            incompleteModal.classList.remove('hidden');
            setTimeout(() => incompleteModal.classList.remove('opacity-0'), 10);
        }

        function hideIncompleteModal() {
             incompleteModal.classList.add('opacity-0');
            setTimeout(() => {
                incompleteModal.classList.add('hidden');
                resetAll();
            }, 300);
        }

        function createConfetti() {
            const container = document.getElementById('confetti-container');
            container.innerHTML = '';
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800'];
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = `${Math.random() * 2}s`;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                container.appendChild(confetti);
            }
        }
        
        resetBtn.addEventListener('click', resetAll);
        taskListContainer.addEventListener('change', handleTaskCheck);
        closeModalBtn.addEventListener('click', hideCompletionModal);
        incompleteBtn.addEventListener('click', showIncompleteModal);
        closeIncompleteModalBtn.addEventListener('click', hideIncompleteModal);
    }
    
    // --- Recipe App Related (Simplified as it's not the focus of the fix) ---
    function initializeRecipeApp() {
      // Stub for recipe app logic
    }

    // --- Event Listener Assignments ---
    gnb.addEventListener('click', (e) => {
        const button = e.target.closest('.gnb-btn');
        if (button) showView(button.dataset.view);
    });
    
    mainCategoryCards.forEach(card => {
        card.addEventListener('click', () => showView(card.dataset.view));
    });

    mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
    });

    if(globalSearchInput) globalSearchInput.addEventListener('input', () => { /* Stub */ });
    if(globalSearchInputMobile) globalSearchInputMobile.addEventListener('input', () => { /* Stub */ });
    
    // --- App Start ---
    // initializeRecipeApp(); // You can enable this if needed
    initializeChecklistApp();
    showView('home-view'); // Start at home view
});
</script>
</body>
</html>

