<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°±ì–µì»¤í”¼ í†µí•© ìš´ì˜ ë§¤ë‰´ì–¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #FDFBF8;
        }
        .main-category-card {
            transition: all 0.3s ease;
            border: 1px solid #EAE2DA;
        }
        .main-category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-color: #8D6E63;
            background-color: #FBF9F6;
        }
        .recipe-card {
            transition: all 0.3s ease;
            border: 1px solid #EAE2DA;
        }
        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-color: #D1C3B4;
        }
        .category-btn.active {
            background-color: #8D6E63;
            color: white;
            font-weight: 700;
        }
        #mobile-category-nav .category-btn.active {
             border-color: #8D6E63;
             color: #8D6E63;
             background-color: #F1EBE5;
        }
        .version-btn.active {
            background-color: #A1887F;
            color: white;
        }
        .ingredient-block {
            display: inline-block;
            background-color: #F8F5F2;
            border-radius: 6px;
            padding: 4px 8px;
            margin: 2px;
            font-size: 1rem;
            line-height: 1.5rem;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .gnb-btn.active { background-color: #8D6E63; color: white; }
        
        /* --- Checklist Styles --- */
        #checklist-progress-container.sticky {
            position: sticky;
            top: 64px; /* GNB height */
            z-index: 30;
            padding-top: 0.75rem;
            padding-bottom: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            transition: padding 0.3s ease-in-out;
        }
        #checklist-progress-container.sticky #progress-title {
            display: none;
        }
        .progress-bar-wrapper {
            flex-grow: 1; background-color: #e5e7eb; border-radius: 9999px; height: 1rem; overflow: hidden;
        }
        .progress-bar {
            height: 100%; border-radius: 9999px; transition: width 0.3s ease-in-out;
        }
        .task-card {
            display: flex; align-items: center; background-color: white; border: 1px solid #EAE2DA; border-radius: 0.5rem;
            padding: 1rem; transition: all 0.3s ease-in-out; margin-bottom: 0.75rem;
        }
        .task-card.completed {
            opacity: 0.5; background-color: #f3f4f6;
        }
        .task-card.completed label {
            text-decoration: line-through;
        }
        /* Custom checkbox */
        .custom-checkbox {
            appearance: none; -webkit-appearance: none;
            min-width: 1.5rem; width: 1.5rem; height: 1.5rem;
            border: 2px solid #D1C3B4; border-radius: 0.375rem;
            cursor: pointer; display: grid; place-content: center;
        }
        .custom-checkbox::before {
            content: ""; width: 0.8rem; height: 0.8rem;
            transform: scale(0); transition: 120ms transform ease-in-out;
            box-shadow: inset 1em 1em #8D6E63;
            transform-origin: bottom left; clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%);
        }
        .custom-checkbox:checked::before {
            transform: scale(1);
        }
        
        /* Completion Modal Styles */
        #completion-modal { transition: opacity 0.3s ease; }
        #completion-modal .modal-content { animation: zoomIn 0.3s ease forwards; }
        @keyframes zoomIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        /* Confetti Animation */
        .confetti {
            width: 10px; height: 10px; background-color: #f00;
            position: absolute; top: 0; animation: fall 3s linear infinite;
        }
        @keyframes fall {
            to { transform: translateY(100vh) rotate(360deg); }
        }
    </style>
</head>
<body class="text-gray-800">

    <header id="main-gnb" class="bg-white shadow-md sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <button class="gnb-btn font-bold text-xl text-[#6D4C41] active hidden md:flex items-center" data-view="home-view">
                        <i class="fas fa-home mr-2"></i>ë°±ì–µì»¤í”¼ ë§¤ë‰´ì–¼
                    </button>
                    <button class="gnb-btn flex md:hidden items-center space-x-2 active" data-view="home-view">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSmgK7X5UjYipj8B0revMEDlmBiNaoJfIDfpw&s" class="h-8 w-auto" alt="ë°±ì–µì»¤í”¼ ë¡œê³ ">
                        <span class="font-bold text-lg text-[#6D4C41]">ë§¤ë‰´ì–¼</span>
                    </button>
                </div>
                <div class="hidden md:flex items-center">
                    <div class="relative mr-4">
                        <input type="text" id="global-search-input" placeholder="í†µí•© ê²€ìƒ‰..." class="w-48 lg:w-64 px-3 py-2 pl-10 text-sm border border-[#D7CCC8] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#A1887F] transition duration-200">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                    <div class="flex items-baseline space-x-4">
                        <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium" data-view="system-view">ì‹œìŠ¤í…œ</button>
                        <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium" data-view="inventory-view">ë°œì£¼/ì¬ê³ </button>
                        <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium" data-view="status-view">ë©”ë‰´ê´€ë¦¬</button>
                        <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium" data-view="cleaning-view">ì²­ì†Œ</button>
                        <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium" data-view="checklist-view">ì²´í¬ë¦¬ìŠ¤íŠ¸</button>
                        <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] px-3 py-2 rounded-md text-sm font-medium" data-view="recipe-view">ë ˆì‹œí”¼</button>
                    </div>
                </div>
                <div class="flex items-center md:hidden">
                    <div class="relative">
                        <input type="text" id="global-search-input-mobile" placeholder="ë ˆì‹œí”¼ ê²€ìƒ‰..." class="w-36 sm:w-48 px-3 py-1.5 pl-8 text-sm border border-[#D7CCC8] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#A1887F] transition duration-200">
                        <i class="fas fa-search absolute left-2.5 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                    <button type="button" id="mobile-menu-button" class="ml-2 p-2 rounded-md text-gray-500 hover:text-gray-800 hover:bg-gray-100 focus:outline-none">
                        <span class="sr-only">Open main menu</span>
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <div class="md:hidden hidden" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium w-full text-left" data-view="system-view">ì‹œìŠ¤í…œ ê´€ë¦¬</button>
                <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium w-full text-left" data-view="inventory-view">ë°œì£¼ ë° ì¬ê³  ê´€ë¦¬</button>
                <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium w-full text-left" data-view="status-view">ë©”ë‰´ í’ˆì ˆ/í•´ì œ ê´€ë¦¬</button>
                <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium w-full text-left" data-view="cleaning-view">ë§¤ì¥ ì²­ì†Œ ë° ë¶„ë¦¬ë°°ì¶œ</button>
                <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium w-full text-left" data-view="checklist-view">ì²´í¬ë¦¬ìŠ¤íŠ¸</button>
                <button class="gnb-btn text-gray-600 hover:bg-[#E0DACE] hover:text-[#6D4C41] block px-3 py-2 rounded-md text-base font-medium w-full text-left" data-view="recipe-view">ë ˆì‹œí”¼ ëª©ë¡</button>
            </div>
        </div>
    </header>

    <div id="app-container">
        <!-- Home View -->
        <div id="home-view">
            <main class="p-4 sm:p-8">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
                    <div class="main-category-card bg-white rounded-lg shadow-sm p-6 cursor-pointer text-center" data-view="system-view">
                        <i class="fas fa-desktop fa-3x text-[#A1887F] mb-4"></i>
                        <h2 class="text-xl font-bold text-[#6D4C41]">ì‹œìŠ¤í…œ ê´€ë¦¬</h2>
                        <p class="text-gray-500 mt-1">í¬ìŠ¤, ë°°ë‹¬ì•±</p>
                    </div>
                    <div class="main-category-card bg-white rounded-lg shadow-sm p-6 cursor-pointer text-center" data-view="inventory-view">
                        <i class="fas fa-boxes fa-3x text-[#A1887F] mb-4"></i>
                        <h2 class="text-xl font-bold text-[#6D4C41]">ë°œì£¼ ë° ì¬ê³  ê´€ë¦¬</h2>
                         <p class="text-gray-500 mt-1">ì£¼ë¬¸, ì¬ê³  í™•ì¸</p>
                    </div>
                    <div class="main-category-card bg-white rounded-lg shadow-sm p-6 cursor-pointer text-center" data-view="status-view">
                        <i class="fas fa-toggle-on fa-3x text-[#A1887F] mb-4"></i>
                        <h2 class="text-xl font-bold text-[#6D4C41]">ë©”ë‰´ í’ˆì ˆ/í•´ì œ ê´€ë¦¬</h2>
                         <p class="text-gray-500 mt-1">ë©”ë‰´ ìƒíƒœ ë³€ê²½</p>
                    </div>
                    <div class="main-category-card bg-white rounded-lg shadow-sm p-6 cursor-pointer text-center" data-view="cleaning-view">
                        <i class="fas fa-broom fa-3x text-[#A1887F] mb-4"></i>
                        <h2 class="text-xl font-bold text-[#6D4C41]">ë§¤ì¥ ì²­ì†Œ ë° ë¶„ë¦¬ë°°ì¶œ</h2>
                         <p class="text-gray-500 mt-1">ì²­ê²° ê´€ë¦¬</p>
                    </div>
                    <div class="main-category-card bg-white rounded-lg shadow-sm p-6 cursor-pointer text-center" data-view="checklist-view">
                        <i class="fas fa-clipboard-list fa-3x text-[#A1887F] mb-4"></i>
                        <h2 class="text-xl font-bold text-[#6D4C41]">ê·¼ë¬´ êµëŒ€ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
                         <p class="text-gray-500 mt-1">ì¸ìˆ˜ì¸ê³„ í•­ëª©</p>
                    </div>
                    <div class="main-category-card bg-white rounded-lg shadow-sm p-6 cursor-pointer text-center" data-view="recipe-view">
                        <i class="fas fa-book-open fa-3x text-[#A1887F] mb-4"></i>
                        <h2 class="text-xl font-bold text-[#6D4C41]">ë ˆì‹œí”¼ ëª©ë¡</h2>
                         <p class="text-gray-500 mt-1">ìŒë£Œ, í‘¸ë“œ ì œì¡°ë²•</p>
                    </div>
                </div>
            </main>
        </div>

        <!-- Detail Views (Initially Hidden) -->
        <div id="detail-views" class="hidden">
            <div id="system-view" class="p-8">
                <h1 class="text-3xl font-bold text-[#6D4C41] mb-4">ì‹œìŠ¤í…œ (í¬ìŠ¤, ë°°ë‹¬ì•±) ê´€ë¦¬</h1>
                <p class="text-gray-700">ì‹œìŠ¤í…œ ê´€ë¦¬ ë”ë¯¸ ë°ì´í„°ì…ë‹ˆë‹¤. ì—¬ê¸°ì— í¬ìŠ¤ê¸° ì‚¬ìš©ë²•, ë°°ë‹¬ì•± ì£¼ë¬¸ ì²˜ë¦¬ ë°©ë²• ë“±ì— ëŒ€í•œ ë‚´ìš©ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
            <div id="inventory-view" class="p-8">
                <h1 class="text-3xl font-bold text-[#6D4C41] mb-4">ë°œì£¼ ë° ì¬ê³  ê´€ë¦¬</h1>
                <p class="text-gray-700">ë°œì£¼ ë° ì¬ê³  ê´€ë¦¬ ë”ë¯¸ ë°ì´í„°ì…ë‹ˆë‹¤. ì—¬ê¸°ì— ì£¼ê°„ ë°œì£¼ ëª©ë¡, ì¬ê³  í™•ì¸ ë°©ë²•, ìœ í†µê¸°í•œ ê´€ë¦¬ ë“±ì— ëŒ€í•œ ë‚´ìš©ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
            <div id="status-view" class="p-8">
                <h1 class="text-3xl font-bold text-[#6D4C41] mb-4">ë©”ë‰´ í’ˆì ˆ / í’ˆì ˆ í•´ì œ ê´€ë¦¬</h1>
                <p class="text-gray-700">ë©”ë‰´ í’ˆì ˆ/í•´ì œ ê´€ë¦¬ ë”ë¯¸ ë°ì´í„°ì…ë‹ˆë‹¤. ì—¬ê¸°ì— ê° ë°°ë‹¬ì•± ë° í¬ìŠ¤ì—ì„œ ë©”ë‰´ ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ë‚´ìš©ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
             <div id="cleaning-view" class="p-8">
                <h1 class="text-3xl font-bold text-[#6D4C41] mb-4">ë§¤ì¥ ì²­ì†Œ ë° ë¶„ë¦¬ë°°ì¶œ ê´€ë¦¬</h1>
                <p class="text-gray-700">ë§¤ì¥ ì²­ì†Œ ë° ë¶„ë¦¬ë°°ì¶œ ê´€ë¦¬ ë”ë¯¸ ë°ì´í„°ì…ë‹ˆë‹¤. ì—¬ê¸°ì— ì¼ê°„/ì£¼ê°„ ì²­ì†Œ ì²´í¬ë¦¬ìŠ¤íŠ¸, ë¶„ë¦¬ë°°ì¶œ ìš”ë ¹ ë“±ì— ëŒ€í•œ ë‚´ìš©ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>
             <div id="checklist-view" class="p-8 max-w-4xl mx-auto">
                <h1 class="text-3xl font-bold text-[#6D4C41] mb-8 text-center">ê·¼ë¬´ êµëŒ€ ì²´í¬ë¦¬ìŠ¤íŠ¸</h1>
                
                <!-- Shift Selection -->
                <div id="shift-selection-container" class="mb-8">
                    <h2 class="text-xl font-semibold text-center text-gray-700 mb-4">ê·¼ë¬´ íƒ€ì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</h2>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <button data-shift="open" class="shift-btn bg-yellow-400 text-white font-bold py-4 rounded-lg shadow-md hover:bg-yellow-500 transition-all">ğŸŒ ì˜¤í”ˆ</button>
                        <button data-shift="middle" class="shift-btn bg-sky-400 text-white font-bold py-4 rounded-lg shadow-md hover:bg-sky-500 transition-all">ğŸŒ¥ï¸ ë¯¸ë“¤</button>
                        <button data-shift="closing" class="shift-btn bg-indigo-400 text-white font-bold py-4 rounded-lg shadow-md hover:bg-indigo-500 transition-all">ğŸŒœ ë§ˆê°</button>
                        <button data-shift="late-night" class="shift-btn bg-gray-600 text-white font-bold py-4 rounded-lg shadow-md hover:bg-gray-700 transition-all">â­ ì‹¬ì•¼</button>
                    </div>
                </div>

                <!-- Checklist Area -->
                <div id="checklist-area" class="hidden">
                    <!-- Progress Bar Container -->
                    <div id="checklist-progress-container" class="bg-white rounded-lg shadow-md p-6 mb-6 transition-all">
                        <div class="flex justify-between items-center mb-4">
                            <h2 id="progress-title" class="text-xl font-bold text-[#6D4C41]">ì—…ë¬´ ì™„ë£Œ í˜„í™©</h2>
                             <button id="reset-checklist-btn" class="text-sm text-gray-500 hover:text-gray-800 transition-colors"><i class="fas fa-undo mr-1"></i>ë‹¤ì‹œ ì„ íƒ</button>
                        </div>
                        <div class="flex items-center gap-4">
                            <div id="progress-bar-label" class="w-20 text-center font-semibold text-gray-700"></div>
                            <div class="progress-bar-wrapper">
                                <div id="progress-bar" class="progress-bar" style="width: 0%;"></div>
                            </div>
                            <span id="progress-text" class="w-12 text-right font-medium text-gray-700 text-lg">0%</span>
                        </div>
                    </div>
                    
                    <!-- Task List -->
                    <div id="task-list-container" class="flex flex-col"></div>
                </div>
            </div>
            <div id="recipe-view">
            </div>
        </div>
    </div>
    
    <!-- Completion Modal -->
    <div id="completion-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div id="confetti-container" class="absolute inset-0 overflow-hidden"></div>
        <div class="modal-content bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full text-center relative transform opacity-0">
            <h2 class="text-4xl font-bold text-[#8D6E63] mb-4">ğŸ‰ êµëŒ€ ì¤€ë¹„ ì™„ë£Œ! ğŸ‰</h2>
            <p class="text-gray-700 text-lg mb-6">êµëŒ€ ì¤€ë¹„ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! <br> ì˜¤ëŠ˜ í•˜ë£¨ë„ ìˆ˜ê³  ë§ìœ¼ì…¨ì–´ìš”! ğŸ‘</p>
            <p class="bg-amber-100 text-amber-800 font-semibold p-4 rounded-lg">
                <i class="fas fa-camera mr-2"></i>ì´ í™”ë©´ì„ ìº¡ì²˜í•˜ì—¬ ë‹¨í†¡ë°©ì— ì˜¬ë ¤ì£¼ì„¸ìš”.
            </p>
            <button id="close-modal-btn" class="mt-8 bg-[#8D6E63] text-white font-bold py-2 px-6 rounded-lg hover:bg-[#A1887F] transition-all">ë‹«ê¸°</button>
        </div>
    </div>


<script>
const recipeData = [
    // ... (ë ˆì‹œí”¼ ë°ì´í„°ëŠ” ì´ì „ê³¼ ë™ì¼í•˜ì—¬ ìƒëµ)
    { category: 'í‘¸ë“œ', name: 'ë°”ì‚­ ê°ì ì¹˜ì¦ˆë³¼ (5ea)', image: "https://placehold.co/600x400/FFD700/FFFFFF?text=Potato+Cheese+Ball", versions: { 'ì¡°ë¦¬ë²•': { ingredients:['ì¹˜ì¦ˆë³¼ 5ê°œ', 'ì¼€ì°¹ 40g'], instructions: ["í•´ë™ ì—†ì´ ì—ì–´í”„ë¼ì´ê¸° 6ë¶„", "ìƒŒë“œìœ„ì¹˜ ìš©ê¸°ì— ë‹´ì•„ ì¼€ì°¹ê³¼ í•¨ê»˜ ì œê³µ", "ì¡°ë¦¬ í›„ ìµœì†Œ 30ì´ˆ ê³µê¸°ì™€ ì ‘ì´‰ í›„ ëšœê»‘ ë‹«ê¸°"] } } },
    { category: 'íŒì½˜', name: 'ì¹´ë¼ë©œ íŒì½˜', image: "https://placehold.co/600x400/DAA520/FFFFFF?text=Caramel+Popcorn", versions: { 'ì¡°ë¦¬ë²•': { ingredients: ['íŒì½˜ ì˜¥ìˆ˜ìˆ˜: 1 CUP', 'íŒì½˜ ì˜¤ì¼: 150ml', 'ì¹´ë¼ë©œ ì‹œì¦ˆë‹: 180ml'], instructions: ['ëª¨í„°ì™€ íˆí„°ë¥¼ í•¨ê»˜ ON í•©ë‹ˆë‹¤.', 'ì˜¤ì¼ â†’ ì‹œì¦ˆë‹ â†’ ì˜¥ìˆ˜ìˆ˜ ìˆœìœ¼ë¡œ ë„£ìŠµë‹ˆë‹¤.', 'íŒì½˜ì´ 20ê°œ ì •ë„ í„°ì§€ë©´ íˆí„°ë¥¼ OFF í•©ë‹ˆë‹¤.', 'ì†Œë¦¬ê°€ ë©ˆì¶”ë©´ ëª¨í„°ë¥¼ ë„ê³  ì •ë¦¬í•©ë‹ˆë‹¤.'] } } },
    { category: 'íŒì½˜', name: 'ë”¸ê¸° íŒì½˜', image: "https://placehold.co/600x400/FFC0CB/FFFFFF?text=Strawberry+Popcorn", versions: { 'ì¡°ë¦¬ë²•': { ingredients: ["íŒì½˜ ì˜¥ìˆ˜ìˆ˜: 1.5 CUP", "íŒì½˜ ì˜¤ì¼: 1 CUP", "ì¹´ë¼ë©œ ì‹œì¦ˆë‹: 1.2 CUP"], instructions: ["ì¹´ë¼ë©œ íŒì½˜ ì¡°ë¦¬ë²•ê³¼ ë™ì¼í•©ë‹ˆë‹¤."] } } }
];

const checklistData = {
    common: [
        { group: 'ì¶œê·¼ ì‹œ', task: 'ì¡°ëª… / ì–´ë‹ / DID ëª¨ë‹ˆí„° í™•ì¸' },
        { group: 'ì¶œê·¼ ì‹œ', task: 'ë°°ë‹¬ ì–´í”Œ í™•ì¸' },
        { group: 'ì¶œê·¼ ì‹œ', task: 'ì‹œì¬ ì¸ìˆ˜ì¸ê³„ ë° ì „ë‹¬ì‚¬í•­ í™•ì¸' },
        { group: 'ì¶œê·¼ ì‹œ', task: 'ì œë¹™ê¸° ì–¼ìŒì–‘ í™•ì¸' },
        { group: 'êµì²´ ì‹œ', task: '<span class="font-bold">ì›ë‘:</span> ê·¸ë¼ì¸ë” í˜¸í¼ ë¶„ë¦¬ í›„ ì²­ì†Œ' },
        { group: 'êµì²´ ì‹œ', task: '<span class="font-bold">ì‹œëŸ½:</span> êµ³ì§€ ì•Šë„ë¡ ëœ¨ê±°ìš´ ë¬¼ ë¹¼ì£¼ê¸°' },
        { group: 'ì±„ì›Œì£¼ê¸°', task: 'íŒì½˜, ë‚˜ìµ¸, ëŒ€ìš©ëŸ‰ ë² ì´ìŠ¤, ìŒë£Œìš© ê°€ë‹¹ë”¸ê¸°' },
        { group: 'ì±„ì›Œì£¼ê¸°', task: 'ëƒ‰ì¥í•´ë™ ë””ì €íŠ¸, ì˜¤ì§•ì–´' },
        { group: 'ì±„ì›Œì£¼ê¸°', task: '2ì˜¨ìŠ¤ ì†ŒìŠ¤í†µ, ì‹œëŸ½ ë° íŒŒìš°ë”, ê°ì¢… ë¶€ìì¬' },
        { group: 'í‡´ê·¼ í•œ ì‹œê°„ ì „', task: 'ì»¤í”¼í½, ì“°ë ˆê¸°í†µ, ì‹±í¬ëŒ€, ìš°ìœ ê³½, ë°°ìˆ˜êµ¬ í™•ì¸ ë° êµì²´' },
        { group: 'í‡´ê·¼ í•œ ì‹œê°„ ì „', task: 'ìë™ íƒ¬í•‘ê¸° ë‚´ë¶€ ë¸ŒëŸ¬ì‰¬ ì²­ì†Œ, ì‹¤ë§ê¸° ì˜¤ì—¼ ì œê±°' },
        { group: 'í‡´ê·¼ í•œ ì‹œê°„ ì „', task: 'ì»¤í”¼ ë°” ì „ì²´ ì •ë¦¬ ë° ì²­ì†Œ' },
        { group: 'í‡´ê·¼ í•œ ì‹œê°„ ì „', task: 'ì°ë”¸ê¸°ìš© ê³„ëŸ‰ìŠ¤í‘¼ ë¬¼ êµì²´' },
        { group: 'í‡´ê·¼ í•œ ì‹œê°„ ì „', task: 'í–‰ì£¼, ìŠ¤íŒ€í–‰ì£¼ ì„¸ì²™' },
        { group: 'í‡´ê·¼ í•œ ì‹œê°„ ì „', task: 'ì‹œì¬ í™•ì¸ ë° ì¸ìˆ˜ì¸ê³„ ì‚¬í•­ ë‚¨ê¸°ê¸°' },
    ],
    open: [
        { group: 'ì˜¤í”ˆ ì—…ë¬´', task: 'í”½ì—…ëŒ€ ë° í¬ìŠ¤ê¸° ì£¼ë³€ ì •ë¦¬ ë° ì²­ì†Œ' },
        { group: 'ì˜¤í”ˆ ì—…ë¬´', task: 'í–‰ì£¼ ì„¸ì²™' },
        { group: 'ì˜¤í”ˆ ì—…ë¬´', task: 'ëƒ‰ì¥/ìƒì˜¨/ì‹¤ì˜¨ ì •ë¦¬ ë° ì„ ì…ì„ ì¶œ í™•ì¸' },
        { group: 'ì˜¤í”ˆ ì—…ë¬´', task: 'ì¬ê³  ë° ë°œì£¼ í™•ì¸' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ìƒë¶€/ëŒ€ìš©ëŸ‰ ëƒ‰ì¥ê³  ë¬¼ê¸° ì œê±°' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> íŒŒìš°ë” ì„ ë°˜, ì‹œëŸ½ë³‘ ê·¼ì²˜ ë°”ë‹¥ ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> íŒŒìš°ë” ìŠ¤í‘¼ ì„¸ì²™ ë° ê±´ì¡°' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ì›”,ìˆ˜,ê¸ˆ)</span> ì‹±í¬ëŒ€ ë¬¼ë•Œ ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(í™”)</span> ì˜¤ê±°ë‚˜ì´ì € ë¹ˆ, íŒì½˜ ê¸°ê³„ ë’¤ìª½ ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ëª©)</span> ì°½ë¬¸í‹€, í‚¤ì˜¤ìŠ¤í¬ ì–‘ìª½ ë¨¼ì§€ ì œê±°' },
    ],
    middle: [
        { group: 'ë¯¸ë“¤ ì—…ë¬´', task: 'ë§¤ì¥ ë°–, ë¬¸ ì• ì²­ì†Œ (ëª…í•¨, ì“°ë ˆê¸° ë“±)' },
        { group: 'ë¯¸ë“¤ ì—…ë¬´', task: 'ì˜ìˆ˜ì¦ ì“°ë ˆê¸°í†µ, ì»¤í”¼ í½ ë¹„ìš°ê¸°' },
        { group: 'ë¯¸ë“¤ ì—…ë¬´', task: 'ì „ì²´ ë°”ë‹¥ ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ì•„ì´ìŠ¤ë¹ˆ ë° ì„œë ë‚´ë¶€ ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ë¹™ìˆ˜ê¸°ê³„, ë””í¼ì›°, ì†Œë„êµ¬ ì„¸ì²™' },
    ],
    closing: [
        { group: 'ë§ˆê°/ì €ë… ì—…ë¬´', task: '<span class="font-bold">[18:00-20:00]</span> ë¦¬ë·° ëŒ“ê¸€ ë‹¬ê¸°' },
        { group: 'ë§ˆê°/ì €ë… ì—…ë¬´', task: '<span class="font-bold">[20:30]</span> ì‹¬ì•¼ ëŒ€ë¹„ ì¬ë£Œ ì±„ì›Œì ¸ ìˆëŠ”ì§€ í™•ì¸ (ë³¶ìŒë°¥/ê°•ì • ì†Œë¶„)' },
        { group: 'ë§ˆê° ì²­ì†Œ - ì»¤í”¼ë¨¸ì‹ ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ê·¸ë£¹í—¤ë“œ ì†” ì²­ì†Œ ë° ë¬¼ í˜ë¦¬ê¸°' },
        { group: 'ë§ˆê° ì²­ì†Œ - ì»¤í”¼ë¨¸ì‹ ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> í¬í„°í•„í„° ìš©ì•¡ ì„¸ì²™, íŠ¸ë ˆì´ ë¶„ë¦¬ ì„¸ì²™' },
        { group: 'ë§ˆê° ì²­ì†Œ - ì»¤í”¼ë¨¸ì‹ ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ì»¤í”¼ë¨¸ì‹  ì „ì²´, ê·¸ë¼ì¸ë”, íƒ¬í•‘ê¸° ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ - ì»¤í”¼ë¨¸ì‹ ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ì˜¨ìˆ˜ê¸°(í™€ë”ìƒì, ë¬¼ ì…ì¶œêµ¬, ì½”í¬ ì†ì¡ì´) ì²­ì†Œ' },
        { group: 'ë§ˆê° ì²­ì†Œ - ì»¤í”¼ë¨¸ì‹ ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ì—ì–´í”„ë¼ì´ì–´ ë§, ì „ìë ˆì¸ì§€ìš© ì ‘ì‹œ ì„¸ì²™' },
    ],
    'late-night': [
        { group: 'ì‹¬ì•¼ ì—…ë¬´', task: 'ì–´ë‹ ì ‘ê¸°, ì‹œì¬ ì •ë¦¬, í¬ìŠ¤ ë§ˆê° ë° ë³´ê³ ' },
        { group: 'ì‹¬ì•¼ ì—…ë¬´', task: 'ë¬¼ë¥˜ ì…ê³  í™•ì¸ ë° ì •ë¦¬ (ë¶ˆëŸ‰ ì²´í¬)' },
        { group: 'ì‹¬ì•¼ ì—…ë¬´', task: '<span class="font-bold">[í‰ì¼]</span> í¬ì¥ì¬ ë¯¸ë¦¬ ì¤€ë¹„ (í•«ë„ê·¸ë°•ìŠ¤, ì˜¤ì§•ì–´ìƒì, ìº”/ì¼€ì´í¬ ìŠ¤í‹°ì»¤ ë“±)' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ì—ì–´í”„ë¼ì´ì–´, ì ‘ì‹œ, ë°”ìŠ¤í‘¼í†µ, ë””í¼ì›° ë§ˆê°' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ëª¨ë“  ì“°ë ˆê¸° ë°°ì¶œ' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ì°½ê³  ì •ë¦¬ ë° ì²­ì†Œ' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ëƒ‰ì¥ê³  ì•„ë˜ ì²­ì†Œ' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ì°½ê³  â†’ ì»¤í”¼ë°” â†’ í™€ ì „ì²´ ë°”ë‹¥ ì“¸ê³  ë‹¦ê¸°' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ëŒ€ê±¸ë ˆ ì„¸ì²™' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ìŠ¤íŒ€í–‰ì£¼ ì„¸ì²™ ë° ê±´ì¡°' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ì˜ìˆ˜ì¦ í†µ ì„¸ì²™ ë° ê±´ì¡°' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ë§¤ì¼)</span> ì¼ë°˜í–‰ì£¼ ì„¸ì œì— ë‹´ê¶ˆë‘ê¸°' },
        { group: '05:00 ë§ˆê°ì²­ì†Œ', task: '<span class="font-semibold text-gray-800">(ì›”,ìˆ˜,ê¸ˆ)</span> ìŒì‹ë¬¼ ì“°ë ˆê¸°í†µ, ë¶„ë¦¬ìˆ˜ê±°í•¨ ì„¸ì²™' },
    ]
};


document.addEventListener('DOMContentLoaded', () => {
    // --- ê¸°ë³¸ ìš”ì†Œ ì„ íƒ ---
    const homeView = document.getElementById('home-view');
    const detailViewsContainer = document.getElementById('detail-views');
    const mainCategoryCards = document.querySelectorAll('.main-category-card');
    const gnb = document.getElementById('main-gnb');
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const globalSearchInput = document.getElementById('global-search-input');
    const globalSearchInputMobile = document.getElementById('global-search-input-mobile');
    
    // --- ë ˆì‹œí”¼ ì•± ê´€ë ¨ ë³€ìˆ˜ ---
    let currentRecipeCategory = 'all';

    // --- ë·°(í™”ë©´) ì „í™˜ í•¨ìˆ˜ ---
    function showView(viewId) {
        if (viewId === 'home-view') {
            homeView.style.display = 'block';
            detailViewsContainer.classList.add('hidden');
        } else {
            homeView.style.display = 'none';
            detailViewsContainer.classList.remove('hidden');
            document.querySelectorAll('#detail-views > div').forEach(view => {
                view.style.display = 'none';
            });
            const targetView = document.getElementById(viewId);
            if (targetView) {
                targetView.style.display = 'block';
            }
        }
        document.querySelectorAll('.gnb-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll(`.gnb-btn[data-view="${viewId}"]`).forEach(btn => btn.classList.add('active'));
        mobileMenu.classList.add('hidden');

        if (viewId !== 'recipe-view') {
            if (globalSearchInput) globalSearchInput.value = '';
            if (globalSearchInputMobile) globalSearchInputMobile.value = '';
        }
    }

    // --- ê¸€ë¡œë²Œ ê²€ìƒ‰ ì²˜ë¦¬ í•¨ìˆ˜ ---
    function handleGlobalSearch(e) {
        const searchTerm = e.target.value;
        if (globalSearchInput) globalSearchInput.value = searchTerm;
        if (globalSearchInputMobile) globalSearchInputMobile.value = searchTerm;
        showView('recipe-view');
        const recipeSearchInput = document.getElementById('search-input');
        const mobileRecipeSearchInput = document.getElementById('mobile-search-input');
        if(recipeSearchInput) recipeSearchInput.value = searchTerm;
        if(mobileRecipeSearchInput) mobileRecipeSearchInput.value = searchTerm;
        currentRecipeCategory = 'all';
        document.querySelectorAll('#recipe-view .category-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll(`#recipe-view .category-btn[data-category="all"]`).forEach(btn => btn.classList.add('active'));
        renderRecipes('all', searchTerm);
    }
    
    // --- ë ˆì‹œí”¼ ì•± ì´ˆê¸°í™” ë° ê´€ë ¨ í•¨ìˆ˜ ---
    function initializeRecipeApp() {
        const recipeViewContainer = document.getElementById('recipe-view');
        if (recipeViewContainer.innerHTML.trim() !== '') return;

        recipeViewContainer.innerHTML = `
            <div class="relative min-h-screen">
                <aside id="sidebar" class="hidden md:flex sidebar bg-[#F1EBE5] text-[#6D4C41] w-64 fixed inset-y-0 left-0 transform md:translate-x-0 z-30 flex flex-col h-screen">
                    <div class="flex-shrink-0 px-4 pt-7"><div class="relative mb-4"><input type="text" id="search-input" placeholder="ë©”ë‰´ ê²€ìƒ‰..." class="w-full px-4 py-2 border border-[#D7CCC8] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#A1887F]"><i class="fas fa-search absolute right-3 top-1/2 -translate-y-1/2 text-gray-400"></i></div></div>
                    <nav id="category-nav" class="flex-grow overflow-y-auto px-4 pb-7"><button class="w-full text-left text-base font-medium rounded-lg py-2.5 px-4 hover:bg-[#E0DACE] category-btn active" data-category="all">ì „ì²´ ë©”ë‰´</button></nav>
                </aside>
                <div class="md:ml-64">
                    <div class="md:hidden sticky top-16 z-10 bg-white shadow-md">
                         <div class="px-4 pt-3 pb-3"><div class="relative"><input type="text" id="mobile-search-input" placeholder="ë©”ë‰´ ê²€ìƒ‰..." class="w-full px-4 py-2 border border-[#D7CCC8] rounded-lg focus:outline-none focus:ring-2 focus:ring-[#A1887F]"><i class="fas fa-search absolute right-3 top-1/2 -translate-y-1/2 text-gray-400"></i></div></div>
                        <nav id="mobile-category-nav" class="bg-white border-t border-gray-200 px-2 overflow-x-auto no-scrollbar flex space-x-2"></nav>
                    </div>
                    <main class="main-content flex-1 p-4 sm:p-6 lg:p-10"><div class="max-w-7xl mx-auto"><div id="recipe-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6"></div><div id="no-results" class="hidden text-center py-10"><p class="text-xl text-gray-500">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div></div></main>
                </div>
            </div>`;
        
        const categoryNav = document.getElementById('category-nav');
        const mobileCategoryNav = document.getElementById('mobile-category-nav');
        const recipeGrid = document.getElementById('recipe-grid');
        const searchInput = document.getElementById('search-input');
        const mobileSearchInput = document.getElementById('mobile-search-input');
        const categories = ['all', ...new Set(recipeData.map(recipe => recipe.category))];

        function setupCategories() {
            const desktopNavFragment = document.createDocumentFragment();
            const mobileNavFragment = document.createDocumentFragment();
            const allMobileButton = document.createElement('button');
            allMobileButton.className = 'flex-shrink-0 text-sm font-medium py-2 px-4 border-b-2 category-btn active';
            allMobileButton.dataset.category = 'all';
            allMobileButton.textContent = 'ì „ì²´ ë©”ë‰´';
            mobileCategoryNav.appendChild(allMobileButton);

            categories.slice(1).forEach(category => {
                const button = document.createElement('button');
                button.className = 'w-full text-left text-base font-medium rounded-lg py-2.5 px-4 hover:bg-[#E0DACE] category-btn';
                button.dataset.category = category;
                button.textContent = category;
                desktopNavFragment.appendChild(button);
                const mobileButton = document.createElement('button');
                mobileButton.className = 'flex-shrink-0 text-sm font-medium py-2 px-4 border-b-2 border-transparent category-btn';
                mobileButton.dataset.category = category;
                mobileButton.textContent = category;
                mobileNavFragment.appendChild(mobileButton);
            });
            categoryNav.appendChild(desktopNavFragment);
            mobileCategoryNav.appendChild(mobileNavFragment);
        }

        function handleCategoryClick(e) {
            const button = e.target.closest('.category-btn');
            if (button) {
                currentRecipeCategory = button.dataset.category;
                document.querySelectorAll('#recipe-view .category-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll(`#recipe-view .category-btn[data-category="${currentRecipeCategory}"]`).forEach(btn => btn.classList.add('active'));
                searchInput.value = '';
                mobileSearchInput.value = '';
                if(globalSearchInput) globalSearchInput.value = '';
                if(globalSearchInputMobile) globalSearchInputMobile.value = '';
                renderRecipes(currentRecipeCategory);
            }
        }
        function handleRecipeSearch(e) {
            const searchTerm = e.target.value;
            if (globalSearchInput) globalSearchInput.value = searchTerm;
            if (globalSearchInputMobile) globalSearchInputMobile.value = searchTerm;
            renderRecipes(currentRecipeCategory, searchTerm);
        }
        recipeGrid.addEventListener('click', (e) => {
            const button = e.target.closest('.version-btn');
            if (button && !button.classList.contains('active')) {
                const card = button.closest('.recipe-card');
                const recipe = JSON.parse(card.dataset.recipe);
                const version = button.dataset.version;
                card.querySelector('.recipe-text').innerHTML = formatRecipeContent(recipe.versions[version]);
                card.querySelectorAll('.version-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
            }
        });

        categoryNav.addEventListener('click', handleCategoryClick);
        mobileCategoryNav.addEventListener('click', handleCategoryClick);
        searchInput.addEventListener('input', handleRecipeSearch);
        mobileSearchInput.addEventListener('input', handleRecipeSearch);
        setupCategories();
        renderRecipes();
    }
    function formatRecipeContent(versionData) {
        let html = '';
        if (versionData.ingredients) html += `<div class="mb-2"><strong class="text-[#A1887F] text-lg">ì¬ë£Œ:</strong></div><div>${versionData.ingredients.map(ing => `<span class="ingredient-block">${ing}</span>`).join('')}</div>`;
        if (versionData.instructions) html += `<div class="mt-3"><strong class="text-[#A1887F] text-lg">ì¡°ë¦¬ë²•:</strong></div><ol class="list-decimal list-inside text-gray-600 mt-1 space-y-1 text-base">${versionData.instructions.map(inst => `<li>${inst}</li>`).join('')}</ol>`;
        return html;
    }
    function renderRecipes(filter = 'all', searchTerm = '') {
        const recipeGrid = document.getElementById('recipe-grid');
        const noResults = document.getElementById('no-results');
        if (!recipeGrid || !noResults) return;
        recipeGrid.innerHTML = '';
        const lowerCaseSearchTerm = searchTerm.toLowerCase().trim();
        const filteredRecipes = recipeData.filter(r => (filter === 'all' || r.category === filter) && r.name.toLowerCase().includes(lowerCaseSearchTerm));
        noResults.classList.toggle('hidden', filteredRecipes.length > 0);
        const gridFragment = document.createDocumentFragment();
        filteredRecipes.forEach(recipe => {
            const card = document.createElement('div');
            card.className = 'recipe-card bg-white rounded-lg shadow-sm overflow-hidden flex flex-col';
            card.dataset.recipe = JSON.stringify(recipe);
            const versionKeys = Object.keys(recipe.versions);
            const sortOrder = ['ICED', 'ICED (1L)', 'HOT'];
            versionKeys.sort((a, b) => { const iA = sortOrder.indexOf(a), iB = sortOrder.indexOf(b); if (iA!==-1&&iB!==-1) return iA - iB; if(iA!==-1)return -1; if(iB!==-1) return 1; return a.localeCompare(b); });
            const firstVersionKey = versionKeys[0];
            let versionButtons = versionKeys.length > 1 ? versionKeys.map((k, i) => `<button class="version-btn flex-1 px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 transition rounded-md ${i === 0 ? 'active' : ''}" data-version="${k}">${k}</button>`).join('') : `<div class="flex-1 px-3 py-2 text-sm font-bold text-[#6D4C41] bg-gray-100 rounded-md text-center">${versionKeys[0]}</div>`;
            card.innerHTML = `<img src="${recipe.image}" alt="${recipe.name}" class="w-full h-40 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/ffffff?text=Image+Not+Found'"><div class="p-5 flex-grow"><p class="text-sm font-semibold text-[#A1887F]">${recipe.category}</p><h3 class="text-2xl font-bold text-[#6D4C41] mt-1 truncate">${recipe.name}</h3><div class="recipe-text mt-4 text-base leading-relaxed min-h-[8rem]">${formatRecipeContent(recipe.versions[firstVersionKey])}</div></div><div class="bg-gray-50 border-t border-gray-200 p-2 flex flex-wrap rounded-b-lg gap-1">${versionButtons}</div>`;
            gridFragment.appendChild(card);
        });
        recipeGrid.appendChild(gridFragment);
    }
    
    // --- ì²´í¬ë¦¬ìŠ¤íŠ¸ ì•± ì´ˆê¸°í™” ë° ê´€ë ¨ í•¨ìˆ˜ ---
    function initializeChecklistApp() {
        const checklistView = document.getElementById('checklist-view');
        const selectionContainer = document.getElementById('shift-selection-container');
        const checklistArea = document.getElementById('checklist-area');
        const taskListContainer = document.getElementById('task-list-container');
        const progressContainer = document.getElementById('checklist-progress-container');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const progressLabel = document.getElementById('progress-bar-label');
        const resetBtn = document.getElementById('reset-checklist-btn');
        const modal = document.getElementById('completion-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');

        let currentShift = null;
        const shiftInfo = {
            open: { label: 'ğŸŒ ì˜¤í”ˆ', color: 'bg-yellow-400' },
            middle: { label: 'ğŸŒ¥ï¸ ë¯¸ë“¤', color: 'bg-sky-400' },
            closing: { label: 'ğŸŒœ ë§ˆê°', color: 'bg-indigo-400' },
            'late-night': { label: 'â­ ì‹¬ì•¼', color: 'bg-gray-600' }
        };

        function startShift(shift) {
            currentShift = shift;
            selectionContainer.classList.add('hidden');
            checklistArea.classList.remove('hidden');

            progressLabel.textContent = shiftInfo[shift].label;
            progressBar.className = `progress-bar ${shiftInfo[shift].color}`;
            
            generateTaskCards(shift);
            updateProgress();
        }

        function resetShift() {
            currentShift = null;
            selectionContainer.classList.remove('hidden');
            checklistArea.classList.add('hidden');
            taskListContainer.innerHTML = '';
        }

        function generateTaskCards(shift) {
            taskListContainer.innerHTML = '';
            let currentGroup = '';
            
            const tasksToRender = [...checklistData.common, ...checklistData[shift]];
            
            tasksToRender.forEach((taskItem, index) => {
                if (taskItem.group !== currentGroup) {
                    currentGroup = taskItem.group;
                    const groupHeader = document.createElement('h3');
                    groupHeader.className = 'text-lg font-bold text-[#8D6E63] mt-4 mb-2 sticky top-0 bg-[#FDFBF8] py-2';
                    groupHeader.textContent = currentGroup;
                    taskListContainer.appendChild(groupHeader);
                }

                const card = document.createElement('div');
                card.className = 'task-card';
                card.dataset.id = `${shift}-${index}`;
                
                const label = document.createElement('label');
                label.htmlFor = `task-${shift}-${index}`;
                label.className = 'flex-grow text-gray-700';
                label.innerHTML = taskItem.task;

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `task-${shift}-${index}`;
                checkbox.className = 'custom-checkbox ml-4';
                
                card.appendChild(label);
                card.appendChild(checkbox);
                taskListContainer.appendChild(card);
            });
        }
        
        function updateProgress() {
            if (!currentShift) return;

            const tasks = taskListContainer.querySelectorAll('.task-card');
            const totalTasks = tasks.length;
            const completedTasks = taskListContainer.querySelectorAll('.task-card.completed').length;
            
            const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `${percentage}%`;

            if (percentage === 100) {
                showCompletionModal();
            }
        }
        
        function handleTaskCheck(e) {
            if (e.target.matches('input[type="checkbox"]')) {
                const card = e.target.closest('.task-card');
                const isCompleted = e.target.checked;
                card.classList.toggle('completed', isCompleted);
                card.style.order = isCompleted ? 1 : 0; // Move completed to bottom
                updateProgress();
            }
        }

        const observer = new IntersectionObserver(
            ([e]) => e.target.classList.toggle('sticky', e.intersectionRatio < 1),
            { threshold: [1] }
        );
        if(progressContainer) observer.observe(progressContainer);

        function showCompletionModal() {
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.remove('opacity-0'), 10);
            createConfetti();
        }

        function hideCompletionModal() {
            modal.classList.add('opacity-0');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }
        
        function createConfetti() {
            const container = document.getElementById('confetti-container');
            container.innerHTML = '';
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800'];
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = `${Math.random() * 2}s`;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                container.appendChild(confetti);
            }
        }
        
        selectionContainer.addEventListener('click', (e) => {
            const button = e.target.closest('.shift-btn');
            if (button) startShift(button.dataset.shift);
        });
        
        resetBtn.addEventListener('click', resetShift);
        taskListContainer.addEventListener('change', handleTaskCheck);
        closeModalBtn.addEventListener('click', hideCompletionModal);
    }

    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ í• ë‹¹ ---
    gnb.addEventListener('click', (e) => {
        const button = e.target.closest('.gnb-btn');
        if (button) showView(button.dataset.view);
    });
    
    mainCategoryCards.forEach(card => {
        card.addEventListener('click', () => showView(card.dataset.view));
    });

    mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
    });

    if(globalSearchInput) globalSearchInput.addEventListener('input', handleGlobalSearch);
    if(globalSearchInputMobile) globalSearchInputMobile.addEventListener('input', handleGlobalSearch);
    
    // --- ì•± ì‹œì‘ ---
    initializeRecipeApp();
    initializeChecklistApp();
    showView('home-view');
});
</script>
</body>
</html>

