<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-Buy Agent (ChatGPT Style)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gpt: {
                            sidebar: '#202123',
                            main: '#343541',
                            input: '#40414F',
                            hover: '#2A2B32',
                            text: '#D1D5DB',
                            border: '#565869'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Söhne', 'ui-sans-serif', 'system-ui', -apple-system, 'Segoe UI', Roboto, Ubuntu, Cantarell, 'Noto Sans', sans-serif; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        /* Typing Animation */
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* Custom Scrollbar for Sidebar */
        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #565869; border-radius: 4px; }
    </style>
</head>
<body class="bg-gpt-main text-white h-screen flex overflow-hidden">

    <!-- Sidebar (Desktop only) -->
    <aside class="hidden md:flex w-[260px] bg-gpt-sidebar flex-col p-2 space-y-2 border-r border-gray-800">
        <button onclick="location.reload()" class="flex items-center gap-3 px-3 py-3 rounded-md border border-gray-600 hover:bg-gpt-hover transition text-sm text-white text-left mb-2">
            <i class="fas fa-plus text-xs"></i> New chat
        </button>
        
        <div class="flex-1 overflow-y-auto custom-scroll">
            <div class="text-xs font-semibold text-gray-500 px-3 py-2">Today</div>
            <button class="w-full flex items-center gap-3 px-3 py-3 rounded-md hover:bg-gpt-hover transition text-sm text-gray-100 truncate">
                <i class="far fa-message text-gray-400"></i> WayV Album Pricing
            </button>
            <button class="w-full flex items-center gap-3 px-3 py-3 rounded-md hover:bg-gpt-hover transition text-sm text-gray-100 truncate">
                <i class="far fa-message text-gray-400"></i> NewJeans Merch Info
            </button>
             <div class="text-xs font-semibold text-gray-500 px-3 py-2 mt-4">Previous 7 Days</div>
            <button class="w-full flex items-center gap-3 px-3 py-3 rounded-md hover:bg-gpt-hover transition text-sm text-gray-100 truncate">
                <i class="far fa-message text-gray-400"></i> Gentle Monster Sunglasses
            </button>
        </div>

        <div class="border-t border-gray-700 pt-2">
            <button class="w-full flex items-center gap-3 px-3 py-3 rounded-md hover:bg-gpt-hover transition text-sm text-white">
                <i class="fas fa-user text-gray-400"></i> Upgrade to Plus
            </button>
            <button class="w-full flex items-center gap-3 px-3 py-3 rounded-md hover:bg-gpt-hover transition text-sm text-white">
                <div class="w-5 h-5 bg-purple-600 rounded-sm flex items-center justify-center text-[10px]">MJ</div>
                Minji Kim
                <i class="fas fa-ellipsis-h ml-auto text-gray-400"></i>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col relative h-full">
        <!-- Mobile Header -->
        <header class="md:hidden flex items-center justify-between p-4 border-b border-gray-700 bg-gpt-sidebar text-gray-200">
            <button><i class="fas fa-bars"></i></button>
            <span class="font-semibold text-sm">K-Buy Agent 3.5</span>
            <button><i class="fas fa-plus"></i></button>
        </header>

        <!-- Chat Area -->
        <div id="chat-container" class="flex-1 overflow-y-auto pb-40 w-full scrollbar-hide">
            <!-- Initial Empty State (Like GPT) -->
            <div id="welcome-screen" class="h-full flex flex-col items-center justify-center text-center px-4 space-y-8 mt-[-50px]">
                <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mb-2 shadow-lg">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/0/04/ChatGPT_logo.svg" alt="Logo" class="w-10 h-10 opacity-80">
                </div>
                <h2 class="text-2xl font-semibold">How can I help you shop today?</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-2xl">
                    <button onclick="fillInput('https://smtownandstore.com/product/...')" class="border border-gray-600 rounded-xl p-4 text-left hover:bg-gpt-hover transition cursor-pointer">
                        <div class="font-semibold text-sm mb-1">Buy K-Pop Album</div>
                        <div class="text-xs text-gray-400">Calculate shipping for SM Town Store</div>
                    </button>
                    <button onclick="fillInput('Check shipping cost to New York')" class="border border-gray-600 rounded-xl p-4 text-left hover:bg-gpt-hover transition cursor-pointer">
                        <div class="font-semibold text-sm mb-1">Check Shipping</div>
                        <div class="text-xs text-gray-400">Estimate delivery cost to USA</div>
                    </button>
                    <button onclick="fillInput('Guide me through payment process')" class="border border-gray-600 rounded-xl p-4 text-left hover:bg-gpt-hover transition cursor-pointer">
                        <div class="font-semibold text-sm mb-1">Payment Guide</div>
                        <div class="text-xs text-gray-400">How to pay without a Korean card</div>
                    </button>
                    <button onclick="fillInput('Track my order #1234')" class="border border-gray-600 rounded-xl p-4 text-left hover:bg-gpt-hover transition cursor-pointer">
                        <div class="font-semibold text-sm mb-1">Order Status</div>
                        <div class="text-xs text-gray-400">Track existing shipment</div>
                    </button>
                </div>
            </div>
        </div>

        <!-- Input Area (Fixed Bottom) -->
        <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-gpt-main via-gpt-main to-transparent pt-10 pb-6 px-4">
            <div class="max-w-3xl mx-auto w-full relative">
                <div class="relative flex items-center w-full p-3 bg-gpt-input rounded-xl border border-black/10 shadow-md focus-within:border-gray-500/50 focus-within:ring-0">
                    <textarea id="user-input" rows="1" class="w-full bg-transparent text-white border-0 focus:ring-0 resize-none max-h-[200px] py-2 pl-2 pr-10 outline-none scrollbar-hide text-[15px]" placeholder="Send a message..." oninput="this.style.height = ''; this.style.height = this.scrollHeight + 'px'" onkeypress="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"></textarea>
                    <button onclick="sendMessage()" class="absolute right-3 p-2 bg-transparent hover:bg-gray-700 rounded-md text-gray-400 hover:text-white transition">
                        <i class="fas fa-paper-plane text-sm"></i>
                    </button>
                </div>
                <p class="text-center text-[11px] text-gray-500 mt-2">
                    K-Buy Agent may produce inaccurate information about people, places, or facts. <a href="#" class="underline">Privacy Policy</a>
                </p>
            </div>
        </div>
    </main>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const welcomeScreen = document.getElementById('welcome-screen');
        let currentStep = 0;

        function fillInput(text) {
            userInput.value = text;
            userInput.focus();
        }

        function scrollToBottom() {
            chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
        }

        // ChatGPT 스타일 메시지 추가 (Row 형태)
        function addMessage(sender, htmlContent) {
            // 첫 메시지 전송 시 웰컴 스크린 숨김
            if (welcomeScreen.style.display !== 'none') {
                welcomeScreen.style.display = 'none';
            }

            const wrapper = document.createElement('div');
            // User는 배경 투명, Bot은 약간 밝은 회색 배경 (GPT-3.5/4 스타일)
            wrapper.className = `w-full border-b border-black/10 ${sender === 'bot' ? 'bg-[#444654] text-gray-100' : 'bg-transparent text-gray-100'}`;
            
            // 아이콘 설정
            const iconHtml = sender === 'bot' 
                ? `<div class="w-8 h-8 rounded-sm bg-[#19c37d] flex items-center justify-center flex-shrink-0"><img src="https://upload.wikimedia.org/wikipedia/commons/0/04/ChatGPT_logo.svg" class="w-5 h-5 invert brightness-0"></div>`
                : `<div class="w-8 h-8 rounded-sm bg-[#5436DA] flex items-center justify-center flex-shrink-0 text-xs">MJ</div>`;

            wrapper.innerHTML = `
                <div class="max-w-3xl mx-auto flex gap-6 p-4 md:py-6 text-[15px] leading-7">
                    ${iconHtml}
                    <div class="relative flex-1 overflow-hidden min-w-0">
                        ${htmlContent}
                    </div>
                </div>
            `;
            
            chatContainer.appendChild(wrapper);
            scrollToBottom();
            return wrapper;
        }

        function showLoading() {
            const id = 'loading-' + Date.now();
            const html = `
                <div id="${id}" class="flex items-center gap-1 h-6">
                    <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                    <div class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></div>
                </div>
            `;
            addMessage('bot', html);
            return id;
        }

        function removeLoading(id) {
            const el = document.getElementById(id);
            if (el) {
                // 로딩 메시지가 포함된 전체 wrapper를 찾아 제거
                el.closest('.w-full').remove();
            }
        }

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            userInput.value = '';
            userInput.style.height = 'auto'; // 높이 초기화

            addMessage('user', text.replace(/\n/g, '<br>'));
            const loadingId = showLoading();

            setTimeout(() => {
                removeLoading(loadingId);
                processScenario(text);
            }, 1000);
        }

        // --- 시나리오 로직 (기존과 동일하되 디자인 요소 변경) ---
        function processScenario(text) {
            
            if (currentStep === 0) {
                if (text.includes('smtownandstore') || text.includes('http')) {
                    const productHtml = `
                        <p class="mb-3">I've analyzed the URL provided. Here is the product information found:</p>
                        <div class="flex flex-col md:flex-row gap-4 bg-gray-900/50 p-4 rounded-md border border-gray-600 mb-4">
                            <img src="https://img.youtube.com/vi/F5nmWoWpvTU/maxresdefault.jpg" class="w-full md:w-48 h-32 object-cover rounded-md">
                            <div class="flex-1 space-y-1">
                                <h3 class="font-bold text-white text-lg">WayV - Winter Special Album [Phantom]</h3>
                                <div class="text-sm text-gray-300">Category: Album</div>
                                <div class="text-sm text-gray-300">Weight: 0.8 kg (Estimated)</div>
                                <div class="flex items-center gap-2 mt-2">
                                    <span class="bg-gray-700 px-2 py-0.5 rounded text-xs text-gray-300">Price</span>
                                    <span class="font-bold text-green-400">₩ 27,800</span>
                                </div>
                            </div>
                        </div>
                        <p class="mb-4">Would you like me to calculate the full cost including international shipping to your location?</p>
                        <div class="flex gap-3">
                            <button onclick="triggerNextStep(1)" class="bg-[#19c37d] hover:bg-[#1a885d] text-white px-4 py-2 rounded-md text-sm transition font-medium">Yes, Calculate Cost</button>
                            <button class="border border-gray-500 hover:bg-gray-700 px-4 py-2 rounded-md text-sm transition">No, wrong item</button>
                        </div>
                    `;
                    addMessage('bot', productHtml);
                    currentStep = 1;
                } else {
                    addMessage('bot', `I couldn't identify a valid URL. Please provide a link starting with 'http' or 'https' from a supported Korean shopping mall.`);
                }
            } 
            else if (currentStep === 3) {
                // 최종 견적서 (Markdown Table Style)
                const calculationHtml = `
                    <p>Here is the detailed cost breakdown for shipping to <strong>United States</strong>:</p>
                    <div class="my-4 border border-gray-600 rounded-md overflow-hidden text-sm">
                        <table class="w-full text-left">
                            <thead class="bg-gray-700 text-gray-200">
                                <tr>
                                    <th class="p-3">Description</th>
                                    <th class="p-3 text-right">Amount (USD)</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-700 bg-gray-800/50">
                                <tr>
                                    <td class="p-3">Product Price</td>
                                    <td class="p-3 text-right text-gray-300">$21.00</td>
                                </tr>
                                <tr>
                                    <td class="p-3">Domestic Shipping (KR)</td>
                                    <td class="p-3 text-right text-gray-300">$2.30</td>
                                </tr>
                                <tr>
                                    <td class="p-3">Int'l Shipping (EMS)</td>
                                    <td class="p-3 text-right text-gray-300">$24.50</td>
                                </tr>
                                <tr>
                                    <td class="p-3">Service Fee (10%)</td>
                                    <td class="p-3 text-right text-gray-300">$4.78</td>
                                </tr>
                                <tr class="bg-gray-700/30 font-bold">
                                    <td class="p-3 text-white">Total Estimated</td>
                                    <td class="p-3 text-right text-green-400 text-base">$52.58</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <p class="text-xs text-gray-400 mb-4">* Duties and taxes may be collected at delivery by the carrier.</p>
                    <button onclick="triggerNextStep(4)" class="flex items-center gap-2 bg-[#19c37d] hover:bg-[#1a885d] text-white px-5 py-3 rounded-md transition font-semibold">
                        <span>Proceed to Checkout</span>
                        <i class="fas fa-arrow-right text-xs"></i>
                    </button>
                `;
                addMessage('bot', calculationHtml);
                currentStep = 4;
            }
            else if (text.includes("오류") || text.includes("support")) {
                 addMessage('bot', `It seems I'm having trouble retrieving that information. Would you like me to connect you with a human agent via email?`);
            }
        }

        function triggerNextStep(stepIndex) {
            const loadingId = showLoading();
            setTimeout(() => {
                removeLoading(loadingId);
                
                if (stepIndex === 1) {
                    const authHtml = `
                        <p>To calculate the exact shipping fee, I need to know your status.</p>
                        <div class="grid grid-cols-2 gap-3 max-w-sm mt-3">
                            <button onclick="triggerNextStep(2)" class="border border-gray-600 hover:bg-gray-700 p-3 rounded-md text-left transition">
                                <div class="font-bold text-sm">Log In</div>
                                <div class="text-xs text-gray-400">Existing member</div>
                            </button>
                            <button onclick="triggerNextStep(2)" class="border border-gray-600 hover:bg-gray-700 p-3 rounded-md text-left transition">
                                <div class="font-bold text-sm">Guest</div>
                                <div class="text-xs text-gray-400">Quick checkout</div>
                            </button>
                        </div>
                    `;
                    addMessage('bot', authHtml);
                    currentStep = 2;
                } 
                else if (stepIndex === 2) {
                    const addressFormHtml = `
                        <p>Please enter your shipping destination.</p>
                        <div class="bg-gray-800 p-4 rounded-md border border-gray-600 mt-3 max-w-md space-y-3">
                             <div>
                                <label class="block text-xs text-gray-400 mb-1">Country</label>
                                <select class="w-full bg-[#40414F] text-white p-2 rounded border border-gray-600 focus:border-white outline-none">
                                    <option>United States</option>
                                    <option>Canada</option>
                                    <option>Singapore</option>
                                </select>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <input type="text" placeholder="State / Province" class="bg-[#40414F] text-white p-2 rounded border border-gray-600 focus:border-white outline-none text-sm">
                                <input type="text" placeholder="Zip Code" class="bg-[#40414F] text-white p-2 rounded border border-gray-600 focus:border-white outline-none text-sm">
                            </div>
                            <button onclick="submitAddress()" class="w-full bg-[#343541] hover:bg-black border border-gray-500 text-white py-2 rounded transition text-sm">Confirm Address</button>
                        </div>
                    `;
                    addMessage('bot', addressFormHtml);
                    currentStep = 3;
                }
                else if (stepIndex === 4) {
                    const checkoutHtml = `
                        <p>I've generated a secure checkout link for you. Click below to complete your payment.</p>
                        <a href="#" class="inline-flex items-center gap-2 mt-3 text-[#19c37d] hover:underline font-semibold">
                            <i class="fas fa-lock"></i> Secure Checkout Link
                        </a>
                        <p class="text-sm text-gray-400 mt-2">Once paid, we will purchase the item immediately.</p>
                    `;
                    addMessage('bot', checkoutHtml);
                }
            }, 800);
        }

        function submitAddress() {
            addMessage('user', 'Shipping details provided: United States, NY 10001');
            const loadingId = showLoading();
            setTimeout(() => {
                removeLoading(loadingId);
                processScenario('주소입력완료');
            }, 1000);
        }
    </script>
</body>
</html>
